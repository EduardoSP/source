{% extends baseTemplate %}
<!-- {#% extends "webfleetbigui/baseAdminTenant.html" %#} -->
{% load staticfiles %}
{% block titulo %}Seguridad Vial{% endblock %}

{% block codigoPrincipal %}
<!-- Estilos -->
<link href="{% static "select/css/bootstrap-select.min.css" %}"           rel="stylesheet">
<link href="{% static "css/base.css" %}"  rel="stylesheet">
<link href="{% static "DataTables/datatables.min.css" %}" rel="stylesheet" type="text/css"  />
<link href="{% static "datetimepicker/css/bootstrap-datetimepicker.min.css" %}"           rel="stylesheet">
<link href="{% static "mapsPicker/jquery-gmaps-latlon-picker.css" %}" rel="stylesheet" type="text/css" />
<link href="{% static "bootstrap-player/css/bootstrap3_player.css" %}" rel="stylesheet" type="text/css" />

<!-- Bibliotecas -->
<script src="{% static "select/js/bootstrap-select.min.js" %}"></script>
<script src="{% static "moment/moment-with-locales.js"      %}"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/noUiSlider/6.2.0/jquery.nouislider.min.js"></script>
<script src="{% static "DataTables/datatables.min.js" %}"   type="text/javascript" ></script>
<script src="{% static "mapsPicker/jquery-gmaps-latlon-picker.js" %}" ></script>
<!--<script src="{% static "socketio/socket.io.js" %}"></script>-->
<script src="{% static "datetimepicker/js/bootstrap-datetimepicker.min.js"      %}"></script>
<script src="{% static "validatorNuevo/validator.js" %}"></script>
<script src="{% static "bootstrap-player/js/bootstrap3_player.js" %}"   type="text/javascript" ></script>

<script>

var fechaInicioPDF 	= "";
var fechaPDFInicio	= "";
var fechaFinPDF    	= "";
var fechaPDFFin		= "";

//--------- Pinta la tabla de la conducción agreiva

function pintarTablaConduccionAgresiva(data){
	var dataSet = data;
	if ( ! $.fn.DataTable.isDataTable( '#tablaConduccionAgresiva' ) ) {
	    $('#tablaConduccionAgresiva').DataTable({
	        responsive: true,
	        data: dataSet,
	        fixedHeader:true,
	       
	        "pageLength"	:100,
	        "aaSorting": [],
	        language: traduccionDatatables,
	        columns: [
	            {  title: "Placa",
	               data : null
	            },

	            {  title: "Aceleración",
	               data : null
	            },	        
	            {  title: "Frenadas",
	               data : null   },

	            {  title: "Movimiento Abrupto",
	               data : null
	            },

	            {  title: "Excesos de velocidad",
	               data : null
	            },
	            
	        ],
	        "columnDefs": [
	        	{ responsivePriority: 1, targets: 0 },
	        	{ responsivePriority: 2, targets: 1 },
	           
	      	    {
	      	        "targets": [0],
					"render": function (data, type, full, meta){
						// Placa o nombre
					    var nombre = "";
					    if( data.nombre != "" ){
							nombre = data.nombre;
			    		}
	                    if(data.tipoConsulta == "Vehiculo"){
	                    	return '<a href="'+guibase+'/{{tenant}}/adminDetalleVehiculo/'+data.id+'" >'+nombre+'</a>';
	                    }else{
	                    	return '<a href="'+guibase+'/{{tenant}}/adminDetalleConductor/'+data.id+'" >'+nombre+'</a>';
	                    }
	                }
		    	},
		    	{
	      	        "targets": [1],
					"render": function (data, type, full, meta){
					    var aceleracion = "";
					    if( data.aceleracion != "" ){
							aceleracion = data.aceleracion;
			    			var texto;
			    			if (aceleracion == "1"){
			    				texto = " Aceleración";
			    			}else{
			    				texto = " Aceleraciones";
			    			}
			    		}
			    		if(aceleracion == "0"){
			    			return '<div style="text-align:left;">'+ aceleracion +" "+texto+'</div>';
			    		}else{/*
	                    	return '<a href="'+guibase+'/{{tenant}}/adminDetalleConductor/'+data.id+'" >'+aceleracion + texto +'</a>';*/
							return '<div style="text-align:left;"><input type="hidden" class="id"  value="'+data.id+'"/><input type="hidden" class="nombre"  value="'+data.nombre+'"/><a class="aceleracion" href="#" >'+aceleracion + texto +'</a> </div>';
			    		}
	                }
		    	},

		    	{
	      	        "targets": [2],
					"render": function (data, type, full, meta){
					    var frenadas = "";
					    if( data.frenadas != "" ){
							frenadas = data.frenadas;
			    			var texto;
			    			if (frenadas == "1"){
			    				texto = " Frenada";
			    			}else{
			    				texto = " Frenadas";
			    			}
			    		}
			    		if(frenadas == "0"){
			    			return '<div style="text-align:left;">'+ frenadas +" "+texto+'</div>';
			    		}else{
							return '<div style="text-align:left;"><input type="hidden" class="id"  value="'+data.id+'"/><input type="hidden" class="nombre"  value="'+data.nombre+'"/><a class="frenadas" href="#" >'+frenadas + texto +'</a> </div>';
			    		}
	                }
		    	},

		    	{
	      	        "targets": [3],
					"render": function (data, type, full, meta){
					    var movimientosAbruptos = "";
					    if( data.movimientosAbruptos != "" ){
							movimientosAbruptos = data.movimientosAbruptos;
			    			var texto;
			    			if (movimientosAbruptos == "1"){
			    				texto = " Movimiento abrupto";
			    			}else{
			    				texto = " Movimientos abruptos";
			    			}
			    		}
			    		if(movimientosAbruptos == "0"){
			    			return '<div style="text-align:left;">'+ movimientosAbruptos +" "+texto+'</div>';
			    		}else{
							return '<div style="text-align:left;"><input type="hidden" class="id"  value="'+data.id+'"/><input type="hidden" class="nombre"  value="'+data.nombre+'"/><a class="movimientosAbruptos" href="#" >'+movimientosAbruptos + texto +'</a> </div>';
			    		}
	                }
		    	},

		    	{
	      	        "targets": [4],
					"render": function (data, type, full, meta){
					    var excesosVelocidad = "";
					    if( data.excesosVelocidad != "" ){
							excesosVelocidad = data.excesosVelocidad;
			    			var texto;
			    			if (excesosVelocidad == "1"){
			    				texto = " Exceso de Velocidad";
			    			}else{
			    				texto = " Excesos de velocidad";
			    			}
			    		}
			    		if(excesosVelocidad == "0"){
			    			return '<div style="text-align:left;">'+ excesosVelocidad +" "+texto+'</div>';
			    		}else{
							return '<div style="text-align:left;"><input type="hidden" class="id"  value="'+data.id+'"/><input type="hidden" class="nombre"  value="'+data.nombre+'"/><a class="excesosVelocidad" href="#" >'+excesosVelocidad + texto +'</a> </div>';
			    		}
	                }
		    	},


	        ]
	    });
	 }   
	 else{
		$('#tablaConduccionAgresiva').DataTable().clear().rows.add(dataSet).draw();
		
	}

}



//---- Cargar Tabla listado de la conduccion agresiva-----------------------------------------------
var tipoConsulta = ""; // 0 si es placa, 1 si es por conductor
function cargarTablaConduccionAgresiva(){
    var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
    date.format();
    var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
    date.format();
    //si es 0 es por vehiculo, si es 1 es por conductor
    var posicionConduccionAgresiva = $('#grupoConsultaAgresiva')	.val();
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                                
                                            },
                        'data'         : { 
                        					'fechaInicio': fechaInicio,
                        					'fechaFin': fechaFin,
                        					'posicionConduccionAgresiva': posicionConduccionAgresiva,
                        					"numeroOpcionHabilitadaPlataforma" : "4" //seguridad vial
                        				 }
                      };
	
	// valida si la peticion es de un generador de carga
    if(config.getEsGeneradorCarga()){
		//si la peticion es de un generador de carga entonces a la autenticación se le agrega el codigo de acceso
    	peticion["autenticacion"]["codigoAcceso"] = config.getCodigoAcceso();
    }                      
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wsConsultarConduccionAgresiva' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
    	if(respuesta.tipoConsulta == "0"){
    		// Cambia el nombre del encabezado de la primera columna. Placa
    		$('#tablaConduccionAgresiva th:eq(0)').text("Placa");
    		tipoConsulta = "0";
    	}else{
    		// Cambia el nombre del encabezado de la primera columna. Conductor
    		$('#tablaConduccionAgresiva th:eq(0)').text("Conductor");
    		tipoConsulta = "1";
    	}
    	pintarTablaConduccionAgresiva(respuesta["data"]);

    });
    request.fail(function(jqXHR, textStatus){ });
};




//--------- Pinta la tabla encendido y apagado
function pintarTablaEncendidoApagado(data){
	var dataSet = data;
	if ( ! $.fn.DataTable.isDataTable( '#tablaEncendidoApagado' ) ) {
	    $('#tablaEncendidoApagado').DataTable({
	        responsive: true,
	        data: dataSet,
	        fixedHeader:true,
	       
	        "pageLength"	:100,
	        "aaSorting": [],
	        language: traduccionDatatables,
	        columns: [
	            {  title: "Evento",
	               data : null
	            },

	            {  title: "Inicio",
	               data : null
	            },	        
	            {  title: "Fin",
	               data : null   },

	            {  title: "Duración",
	               data : null
	            },
	            
	        ],
	        "columnDefs": [
	        	{ responsivePriority: 1, targets: 0 },
	        	{ responsivePriority: 2, targets: 1 },
	           
	      	    {
	      	        "targets": [0],
					"render": function (data, type, full, meta){
						// encendido o apagado
					    var evento = "";
					    if( data.evento != "" ){
							evento = data.evento;
			    		}
			    		if(evento=="Encendido"){
							return '<div style="color:#149911;">'+evento+'</div>';
			    		}else{
							return '<div style="color:#ff0000;">'+evento+'</div>';
			    		}
			    	}
		    	},
		    	{
	      	        "targets": [1],
					"render": function (data, type, full, meta){
					    var inicio = "";
					    if( data.inicio != "" ){
							inicio = moment(data.inicio).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		return inicio;
	                }
		    	},

		    	{
	      	        "targets": [2],
					"render": function (data, type, full, meta){
					    var fin = "";
					    if( data.fin != "" ){
							fin = moment(data.fin).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		return fin;
	                }
		    	},

		    	{
	      	        "targets": [3],
					"render": function (data, type, full, meta){
					    var duracion = "";
					    if( data.duracion != "" ){
							duracion = data.duracion;
			    		}
			    		return duracion;
	                }
		    	},


	        ]
	    });
	 }   
	 else{
		$('#tablaEncendidoApagado').DataTable().clear().rows.add(dataSet).draw();
		
	}

}


//---- Cargar Tabla listado de la conduccion agresiva-----------------------------------------------

function cargarTablaEncendidoApagado(){
    var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
    date.format();
    var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
    date.format();
    //si es 0 es por vehiculo, si es 1 es por conductor
    var posicionEncendidoApagado = $('#grupoConsultaEncendidoApagado')	.val();
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                                
                                            },
                        'data'         : { 
                        					'fechaInicio': fechaInicio,
                        					'fechaFin': fechaFin,
                        					'posicionEncendidoApagado': posicionEncendidoApagado
                        				 }
                      };
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wsConsultarEncendidoApagado' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
    	pintarTablaEncendidoApagado(respuesta["data"]);

    });
    request.fail(function(jqXHR, textStatus){ });
};

//--------- Pinta la tabla aceleracion

function pintarTablaAceleracion(data){
	var dataSet = data;
	if ( ! $.fn.DataTable.isDataTable( '#tablaDetalleAceleracion' ) ) {
	    $('#tablaDetalleAceleracion').DataTable({
	        responsive: true,
	        data: dataSet,
	        fixedHeader:true,
	       
	        "pageLength"	:100,
	        "aaSorting": [],
	        language: traduccionDatatables,
	        columns: [
	            {  title: "Hora registrada",
	               data : null
	            },

	            {  title: "Ubicacion",
	               data : null
	            },	        
	            {  title: "Conductor",
	               data : null   }
	            
	        ],
	        "columnDefs": [
	        	{ responsivePriority: 1, targets: 0 },
	        	{ responsivePriority: 2, targets: 1 },
	           
	      	    {
	      	        "targets": [0],
					"render": function (data, type, full, meta){
						// Placa o nombre
					    var horaRegistrada = "";
					    if( data.horaRegistrada != "" ){
					    	horaRegistrada = moment(data.horaRegistrada).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		return horaRegistrada;
	                }
		    	},
		    	{
	      	        "targets": [1],
					"render": function (data, type, full, meta){
					    var ubicacion = "";
					    if( data.ubicacion != "" ){
							ubicacion = data.ubicacion;
			    		}

						return '<img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >'+ubicacion+'</a>';
	                }
		    	},

		    	{
	      	        "targets": [2],
					"render": function (data, type, full, meta){
					    var tipoUsuario = "";
					    if( data.tipoUsuario != "" ){
							tipoUsuario = data.tipoUsuario;
			    		}
	                    return tipoUsuario;
	                }
		    	},

	        ]
	    });
	 }   
	 else{
		$('#tablaDetalleAceleracion').DataTable().clear().rows.add(dataSet).draw();
		
	}
	
	// muestra el modal
	$('#formularioAceleracion').modal('show');
}

function cargarTablaDetalleAceleracion(id){
    var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
    date.format();
    var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
    date.format();
    //si es 0 es por vehiculo, si es 1 es por conductor
    var posicionConduccionAgresiva = $('#grupoConsultaAgresiva')	.val();
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                                
                                            },
                        'data'         : { 
                        					'fechaInicio': fechaInicio,
                        					'fechaFin': fechaFin,
                        					'id': id,
                        					'tipoConsulta': tipoConsulta
                        				 }
                      };
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wsConsultarDetalleAceleracion' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
		if(tipoConsulta == "0"){
			// Cambia el nombre del encabezado de la primera columna. Conductor
			$('#tablaDetalleAceleracion th:eq(2)').text("Conductor");
		}else{
			// Cambia el nombre del encabezado de la primera columna. Placa
			$('#tablaDetalleAceleracion th:eq(2)').text("Placa");
		}
    	pintarTablaAceleracion(respuesta["data"]);

    });
    request.fail(function(jqXHR, textStatus){ });

}




//--------- Pinta la tabla frenadas

function pintarTablaFrenadas(data){
	var dataSet = data;
	if ( ! $.fn.DataTable.isDataTable( '#tablaDetalleFrenadas' ) ) {
	    $('#tablaDetalleFrenadas').DataTable({
	        responsive: true,
	        data: dataSet,
	        fixedHeader:true,
	       
	        "pageLength"	:100,
	        "aaSorting": [],
	        language: traduccionDatatables,
	        columns: [
	            {  title: "Hora registrada",
	               data : null
	            },

	            {  title: "Ubicacion",
	               data : null
	            },	        
	            {  title: "Conductor",
	               data : null   }
	            
	        ],
	        "columnDefs": [
	        	{ responsivePriority: 1, targets: 0 },
	        	{ responsivePriority: 2, targets: 1 },
	           
	      	    {
	      	        "targets": [0],
					"render": function (data, type, full, meta){
						// Placa o nombre
					    var horaRegistrada = "";
					    if( data.horaRegistrada != "" ){
					    	horaRegistrada = moment(data.horaRegistrada).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		return horaRegistrada;
	                }
		    	},
		    	{
	      	        "targets": [1],
					"render": function (data, type, full, meta){
					    var ubicacion = "";
					    if( data.ubicacion != "" ){
							ubicacion = data.ubicacion;
			    		}

						return '<img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >'+ubicacion+'</a>';
	                }
		    	},

		    	{
	      	        "targets": [2],
					"render": function (data, type, full, meta){
					    var tipoUsuario = "";
					    if( data.tipoUsuario != "" ){
							tipoUsuario = data.tipoUsuario;
			    		}
	                    return tipoUsuario;
	                }
		    	},

	        ]
	    });
	 }   
	 else{
		$('#tablaDetalleFrenadas').DataTable().clear().rows.add(dataSet).draw();
		
	}
	
	// muestra el modal
	$('#formularioFrenadas').modal('show');
}


function cargarTablaDetalleFrenadas(id){
    var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
    date.format();
    var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
    date.format();
    //si es 0 es por vehiculo, si es 1 es por conductor
    var posicionConduccionAgresiva = $('#grupoConsultaAgresiva')	.val();
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                                
                                            },
                        'data'         : { 
                        					'fechaInicio': fechaInicio,
                        					'fechaFin': fechaFin,
                        					'id': id,
                        					'tipoConsulta': tipoConsulta
                        				 }
                      };
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wsConsultarDetalleFrenadas' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
		if(tipoConsulta == "0"){
			// Cambia el nombre del encabezado de la primera columna. Conductor
			$('#tablaDetalleFrenadas th:eq(2)').text("Conductor");
		}else{
			// Cambia el nombre del encabezado de la primera columna. Placa
			$('#tablaDetalleFrenadas th:eq(2)').text("Placa");
		}
    	pintarTablaFrenadas(respuesta["data"]);

    });
    request.fail(function(jqXHR, textStatus){ });

}



//--------- Pinta la tabla movimientos abruptos

function pintarTablaMovimientosAbruptos(data){
	var dataSet = data;
	if ( ! $.fn.DataTable.isDataTable( '#tablaDetalleMovimientosAbruptos' ) ) {
	    $('#tablaDetalleMovimientosAbruptos').DataTable({
	        responsive: true,
	        data: dataSet,
	        fixedHeader:true,
	       
	        "pageLength"	:100,
	        "aaSorting": [],
	        language: traduccionDatatables,
	        columns: [
	            {  title: "Hora registrada",
	               data : null
	            },

	            {  title: "Ubicacion",
	               data : null
	            },	        
	            {  title: "Conductor",
	               data : null   }
	            
	        ],
	        "columnDefs": [
	        	{ responsivePriority: 1, targets: 0 },
	        	{ responsivePriority: 2, targets: 1 },
	           
	      	    {
	      	        "targets": [0],
					"render": function (data, type, full, meta){
						// Placa o nombre
					    var horaRegistrada = "";
					    if( data.horaRegistrada != "" ){
					    	horaRegistrada = moment(data.horaRegistrada).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		return horaRegistrada;
	                }
		    	},
		    	{
	      	        "targets": [1],
					"render": function (data, type, full, meta){
					    var ubicacion = "";
					    if( data.ubicacion != "" ){
							ubicacion = data.ubicacion;
			    		}

						return '<img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >'+ubicacion+'</a>';
	                }
		    	},

		    	{
	      	        "targets": [2],
					"render": function (data, type, full, meta){
					    var tipoUsuario = "";
					    if( data.tipoUsuario != "" ){
							tipoUsuario = data.tipoUsuario;
			    		}
	                    return tipoUsuario;
	                }
		    	},

	        ]
	    });
	 }   
	 else{
		$('#tablaDetalleMovimientosAbruptos').DataTable().clear().rows.add(dataSet).draw();
		
	}
	
	// muestra el modal
	$('#formularioMovimientosAbruptos').modal('show');
}


function cargarTablaDetalleMovimientosAbruptos(id){
    var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
    date.format();
    var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
    date.format();
    //si es 0 es por vehiculo, si es 1 es por conductor
    var posicionConduccionAgresiva = $('#grupoConsultaAgresiva')	.val();
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                                
                                            },
                        'data'         : { 
                        					'fechaInicio': fechaInicio,
                        					'fechaFin': fechaFin,
                        					'id': id,
                        					'tipoConsulta': tipoConsulta
                        				 }
                      };
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wsConsultarDetalleMovimientosAbruptos' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
		if(tipoConsulta == "0"){
			// Cambia el nombre del encabezado de la primera columna. Conductor
			$('#tablaDetalleMovimientosAbruptos th:eq(2)').text("Conductor");
		}else{
			// Cambia el nombre del encabezado de la primera columna. Placa
			$('#tablaDetalleMovimientosAbruptos th:eq(2)').text("Placa");
		}
    	pintarTablaMovimientosAbruptos(respuesta["data"]);

    });
    request.fail(function(jqXHR, textStatus){ });

}



//--------- Pinta la tabla movimientos abruptos

function pintarTablaExcesosVelocidad(data){
	var dataSet = data;
	if ( ! $.fn.DataTable.isDataTable( '#tablaDetalleExcesosVelocidad' ) ) {
	    $('#tablaDetalleExcesosVelocidad').DataTable({
	        responsive: true,
	        data: dataSet,
	        fixedHeader:true,
	       
	        "pageLength"	:100,
	        "aaSorting": [],
	        language: traduccionDatatables,
	        columns: [
	            {  title: "Hora registrada",
	               data : null
	            },

	            {  title: "Ubicacion",
	               data : null
	            },	        
	            {  title: "Conductor",
	               data : null   }
	            
	        ],
	        "columnDefs": [
	        	{ responsivePriority: 1, targets: 0 },
	        	{ responsivePriority: 2, targets: 1 },
	           
	      	    {
	      	        "targets": [0],
					"render": function (data, type, full, meta){
						// Placa o nombre
					    var horaRegistrada = "";
					    if( data.horaRegistrada != "" ){
					    	horaRegistrada = moment(data.horaRegistrada).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		return horaRegistrada;
	                }
		    	},
		    	{
	      	        "targets": [1],
					"render": function (data, type, full, meta){
					    var ubicacion = "";
					    if( data.ubicacion != "" ){
							ubicacion = data.ubicacion;
			    		}

						return '<img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >'+ubicacion+'</a>';
	                }
		    	},

		    	{
	      	        "targets": [2],
					"render": function (data, type, full, meta){
					    var tipoUsuario = "";
					    if( data.tipoUsuario != "" ){
							tipoUsuario = data.tipoUsuario;
			    		}
	                    return tipoUsuario;
	                }
		    	},

	        ]
	    });
	 }   
	 else{
		$('#tablaDetalleExcesosVelocidad').DataTable().clear().rows.add(dataSet).draw();
		
	}
	
	// muestra el modal
	$('#formularioExcesosVelocidad').modal('show');
}


function cargarTablaDetalleExcesosVelocidad(id){
    var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
    date.format();
    var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
    date.format();
    //si es 0 es por vehiculo, si es 1 es por conductor
    var posicionConduccionAgresiva = $('#grupoConsultaAgresiva')	.val();
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                                
                                            },
                        'data'         : { 
                        					'fechaInicio': fechaInicio,
                        					'fechaFin': fechaFin,
                        					'id': id,
                        					'tipoConsulta': tipoConsulta
                        				 }
                      };
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wsConsultarDetalleExcesosVelocidad' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
		if(tipoConsulta == "0"){
			// Cambia el nombre del encabezado de la primera columna. Conductor
			$('#tablaDetalleExcesosVelocidad th:eq(2)').text("Conductor");
		}else{
			// Cambia el nombre del encabezado de la primera columna. Placa
			$('#tablaDetalleExcesosVelocidad th:eq(2)').text("Placa");
		}
    	pintarTablaExcesosVelocidad(respuesta["data"]);

    });
    request.fail(function(jqXHR, textStatus){ });

}


//--------- Pinta la tabla pausa activa
var setTablaGlobalPausaActiva = []; 
function pintarTablaPausaActiva(data){
	var dataSet 			  = data;
	setTablaGlobalPausaActiva = data;
	if ( ! $.fn.DataTable.isDataTable( '#tablaPausaActiva' ) ) {
	    $('#tablaPausaActiva').DataTable({
	        responsive: true,
	        data: dataSet,
	        fixedHeader:true,
			 buttons: [
				 {
					 extend: 'excelHtml5',
					 title: 'Pausa activa',
					 exportOptions: {
	                    columns: [0, 1, 2, 3, 4, 5]
	                        
	                },
					 customizeData: function ( data ) {
						 //console.log(data);
						 data.header = ["Fecha Infracción", "Conducción desde", "Conducción hasta", "Tiempo Conducción", "Conductor", "Vehículo"]; 
						 data.body = [];
						 for(var i = 0 ; i<setTablaGlobalPausaActiva.length ; i++){
							 var fila       = setTablaGlobalPausaActiva[i];
							 var fechaInfraccion = moment(fila.fechaInfraccion).format("DD/MM/YYYY, hh:mm a");
							 var conduceDesde  		= moment(fila.conduceDesde).format("DD/MM/YYYY, hh:mm a");
							 var conduceHasta  		= moment(fila.conduceHasta).format("DD/MM/YYYY, hh:mm a");
							 var tiempoConduccion 	= fila.tiempoConduccion;
							 var conductor          = fila.conductor;
							 var vehiculo			= fila.vehiculo;
							 data.body.push([
							 	fechaInfraccion,
								conduceDesde,
								conduceHasta,
								tiempoConduccion,
								conductor,
								vehiculo]);
						 }
					 },
					 text: "Descargar Excel"
				 },{
				 	 
					 extend : "pdf",
					 title: function (){
					 	return 'Pausa activa '+ "desde el "+fechaPDFInicio+ " hasta el "+fechaPDFFin;
					 },
					 text: "Descargar pdf",
					 exportOptions: {
	                    columns: [0, 1, 2, 3, 4, 5]
	                        
	                },
					 customize: function(doc) {
					
                    //carta, legal, b4, a3
                    doc.pageSize                     = 'B4';
                    doc.pageOrientation              = "portrait";
                    doc.defaultStyle.fontSize        = 10;
                    doc.defaultStyle.alignment       = 'center';
                    doc.styles.tableHeader.fillColor = '#eb2626';
                    doc.styles.tableHeader.alignment = 'center';

                    doc.content[1].layout =         
                        {
                            hLineWidth: function(i, node) {
                                return (i === 0 || i === node.table.body.length) ? 2 : 1;
                            },
                            vLineWidth: function(i, node) {
                                return (i === 0 || i === node.table.widths.length) ? 2 : 1;
                            },
                            hLineColor: function(i, node) {
                                return (i === 0 || i === node.table.body.length) ? 'white' : 'white';
                            },
                            vLineColor: function(i, node) {
                                return (i === 0 || i === node.table.widths.length) ? 'white' : 'white';
                            },

                        };

                     doc.content.splice( 0, 0, {
                            margin: [ 0, 0, 0, 12 ],
                            alignment   : 'left',
                            image       : imagenPDF
                        } );    

               },
                name: "botonPdf",
                className: "botonPdf",
					 
				 }],
			 dom : "Blfrtip",
	        "pageLength"	:100,
	        "aaSorting": [],
	        language: traduccionDatatables,
	        columns: [
	            {  title: "Fecha Infracción",
	               data : null
	            },

	            {  title: "Conducción desde",
	               data : null
	            },
	            {
	            	title : "Conducción hasta",
	            	data : null
	            },	        
	            {  title: "Tiempo Conducción",
	               data : null   
	            },

	            {  title: "Conductor",
	               data : null
	            },
	            {  title: "Vehículo",
	               data : null
	            },
	            
	        ],
	        "columnDefs": [
	        	{ responsivePriority: 1, targets: 0 },
	        	{ responsivePriority: 2, targets: 1 },
	           
	      	    {
	      	        "targets": [0],
					"render": function (data, type, full, meta){
					    var fechaInfraccion = "";
					    if( data.fechaInfraccion != "" ){
							fechaInfraccion = moment(data.fechaInfraccion).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		return fechaInfraccion;
			    	}
		    	},
		    	{
	      	        "targets": [1],
					"render": function (data, type, full, meta){
					    var conduceDesde = "";
					    if( data.conduceDesde != "" ){
							conduceDesde = moment(data.conduceDesde).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		return conduceDesde;
	                }
		    	},
		    	{
	      	        "targets": [2],
					"render": function (data, type, full, meta){
					    var conduceHasta = "";
					    if( data.conduceHasta != "" ){
							conduceHasta = moment(data.conduceHasta).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		else{
			    			conduceHasta = "En curso";
			    		}
			    		return conduceHasta;
	                }
		    	},

		    	{
	      	        "targets": [3],
					"render": function (data, type, full, meta){
					    var tiempoConduccion = "";
					    if( data.tiempoConduccion != "" ){
							tiempoConduccion = data.tiempoConduccion;
			    		}
			    		else{
			    			tiempoConduccion = "En Curso";
			    		}
			    		return tiempoConduccion;
	                }
		    	},

		    	{
	      	        "targets": [4],
					"render": function (data, type, full, meta){
					    var conductor = "";
					    if( data.conductor != "" ){
							conductor = data.conductor;
			    		}
	                    return '<a href="'+guibase+'/{{tenant}}/adminDetalleConductor/'+data.idConductor+'" >'+conductor+'</a>';
	                }
		    	},
		    	{
	      	        "targets": [5],
					"render": function (data, type, full, meta){
					    var vehiculo = "";
					    if( data.vehiculo != "" ){
							vehiculo = data.vehiculo;
			    		}
			    		return '<a href="'+guibase+'/{{tenant}}/adminDetalleVehiculo/'+data.idVehiculo+'" >'+vehiculo+'</a>';
	                }
		    	},

	        ]
	    });
	 }   
	 else{
		$('#tablaPausaActiva').DataTable().clear().rows.add(dataSet).draw();
		
	}

}


//---- Cargar Tabla pausa activa-----------------------------------------------
function cargarTablaPausaActiva(){
	fechaInicioPDF 	= $('#formRangoFecha1').data('DateTimePicker').date.format();
 	fechaPDFInicio		= moment(fechaInicioPDF).format("DD/MM/YYYY - hh:mm a");
 	fechaFinPDF    	= $('#formRangoFecha2').data('DateTimePicker').date.format();
 	fechaPDFFin		= moment(fechaFinPDF).format("DD/MM/YYYY - hh:mm a");

    var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
    date.format();
    var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
    date.format();
    //si es 0 es por vehiculo, si es 1 es por conductor
    var posicionEncendidoApagado = $('#grupoConsultaEncendidoApagado')	.val();
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                                
                                            },
                        'data'         : { 
                        					'fechaInicio': fechaInicio,
											'fechaFin': fechaFin,
											"numeroOpcionHabilitadaPlataforma" : "4" //Seguridad vial
                        				 }
                      };
	
	// valida si la peticion es de un generador de carga
    if(config.getEsGeneradorCarga()){
		//si la peticion es de un generador de carga entonces a la autenticación se le agrega el codigo de acceso
    	peticion["autenticacion"]["codigoAcceso"] = config.getCodigoAcceso();
    }   

    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wsConsultarPausaActiva' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
    	pintarTablaPausaActiva(respuesta["data"]);

    });
    request.fail(function(jqXHR, textStatus){ });
};

//--------- Pinta la tabla pausa activa



//--------- Pinta la tabla conduccion continua
var setTablaGlobalConduccionContinua = [];
function pintarTablaConduccionContinua(data){
	var dataSet = data;
	setTablaGlobalConduccionContinua = data;
	if ( ! $.fn.DataTable.isDataTable( '#tablaConduccionContinua' ) ) {
	    $('#tablaConduccionContinua').DataTable({
	        responsive: true,
	        data: dataSet,
	        fixedHeader:true,
			 buttons: [
				 {
					 extend: 'excelHtml5',
					 title: 'Conducción continua',
					 exportOptions: {
	                    columns: [0, 1, 2, 3, 4, 5]
	                        
	                },
					 customizeData: function ( data ) {
						 //console.log(data);
						 data.header = ["Fecha Infracción", "Conducción desde", "Conducción hasta", "Tiempo Conducción", "Conductor", "Vehículo"]; 
						 data.body = [];
						 for(var i = 0 ; i<setTablaGlobalConduccionContinua.length ; i++){
							 var fila       = setTablaGlobalConduccionContinua[i];
							 var fechaInfraccion = moment(fila.fechaInfraccion).format("DD/MM/YYYY, hh:mm a");
							 var conduceDesde  		= moment(fila.conduceDesde).format("DD/MM/YYYY, hh:mm a");
							 var conduceHasta  		= moment(fila.conduceHasta).format("DD/MM/YYYY, hh:mm a");
							 var tiempoConduccion 	= fila.tiempoConduccion;
							 var conductor          = fila.conductor;
							 var vehiculo			= fila.vehiculo;
							 data.body.push([
							 	fechaInfraccion,
								conduceDesde,
								conduceHasta,
								tiempoConduccion,
								conductor,
								vehiculo]);
						 }
					 },
					 text: "Descargar Excel"
				 },{
				 	 
					 extend : "pdf",
					 title: function (){
					 	return 'Conducción continua '+ "desde el "+fechaPDFInicio+ " hasta el "+fechaPDFFin;
					 },
					 text: "Descargar pdf",
					 exportOptions: {
	                    columns: [0, 1, 2, 3, 4, 5]
	                        
	                },
					 customize: function(doc) {
					
                    //carta, legal, b4, a3
                    doc.pageSize                     = 'B4';
                    doc.pageOrientation              = "portrait";
                    doc.defaultStyle.fontSize        = 10;
                    doc.defaultStyle.alignment       = 'center';
                    doc.styles.tableHeader.fillColor = '#eb2626';
                    doc.styles.tableHeader.alignment = 'center';

                    doc.content[1].layout =         
                        {
                            hLineWidth: function(i, node) {
                                return (i === 0 || i === node.table.body.length) ? 2 : 1;
                            },
                            vLineWidth: function(i, node) {
                                return (i === 0 || i === node.table.widths.length) ? 2 : 1;
                            },
                            hLineColor: function(i, node) {
                                return (i === 0 || i === node.table.body.length) ? 'white' : 'white';
                            },
                            vLineColor: function(i, node) {
                                return (i === 0 || i === node.table.widths.length) ? 'white' : 'white';
                            },

                        };

                     doc.content.splice( 0, 0, {
                            margin: [ 0, 0, 0, 12 ],
                            alignment   : 'left',
                            image       : imagenPDF
                        } );    

               },
                name: "botonPdf",
                className: "botonPdf",
					 
				 }],
			 dom : "Blfrtip",
	       
	        "pageLength"	:100,
	        "aaSorting": [],
	        language: traduccionDatatables,
	        columns: [
	            {  title: "Fecha Infracción",
	               data : null
	            },

	            {  title: "Conducción desde",
	               data : null
	            },	        
	            {  title: "Conducción hasta",
	               data : null   },

	            {  title: "Tiempo conducción",
	               data : null
	            },
	            {  title: "Conductor",
	               data : null
	            },

	            {  title: "Vehículo",
	               data : null
	            },
	            
	        ],
	        "columnDefs": [
	        	{ responsivePriority: 1, targets: 0 },
	        	{ responsivePriority: 2, targets: 1 },
	           
	      	    {
	      	        "targets": [0],
					"render": function (data, type, full, meta){
					    var fechaInfraccion = "";
					    if( data.fechaInfraccion != "" ){
							fechaInfraccion = moment(data.fechaInfraccion).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		return fechaInfraccion;
			    	}
		    	},
		    	{
	      	        "targets": [1],
					"render": function (data, type, full, meta){
					    var conduceDesde = "";
					    if( data.conduceDesde != "" ){
							conduceDesde = moment(data.conduceDesde).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		return conduceDesde;
	                }
		    	},

		    	{
	      	        "targets": [2],
					"render": function (data, type, full, meta){
					    var tiempoConduccion = "";
					    if( data.tiempoConduccion != "" ){
							tiempoConduccion = data.tiempoConduccion;
			    		}
			    		return tiempoConduccion;
	                }
		    	},
		    	{
	      	        "targets": [3],
					"render": function (data, type, full, meta){
					    var conduceHasta = "";
					    if( data.conduceHasta != "" ){
							conduceHasta = moment(data.conduceHasta).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			    		}
			    		else{
			    			conduceHasta = "En curso";
			    		}
			    		return conduceHasta;
	                }
		    	},

		    	{
	      	        "targets": [4],
					"render": function (data, type, full, meta){
					    var conductor = "";
					    if( data.conductor != "" ){
							conductor = data.conductor;
			    		}
	                    return '<a href="'+guibase+'/{{tenant}}/adminDetalleConductor/'+data.idConductor+'" >'+conductor+'</a>';
	                }
		    	},

		    	{
	      	        "targets": [5],
					"render": function (data, type, full, meta){
					    var vehiculo = "";
					    if( data.vehiculo != "" ){
							vehiculo = data.vehiculo;
			    		}
			    		return '<a href="'+guibase+'/{{tenant}}/adminDetalleVehiculo/'+data.idVehiculo+'" >'+vehiculo+'</a>';
	                }
		    	},

	        ]
	    });
	 }   
	 else{
		$('#tablaConduccionContinua').DataTable().clear().rows.add(dataSet).draw();
		
	}

}


//---- Cargar Tabla conduccion continua-----------------------------------------------
function cargarTablaConduccionContinua(){
	fechaInicioPDF 	= $('#formRangoFecha1').data('DateTimePicker').date.format();
 	fechaPDFInicio		= moment(fechaInicioPDF).format("DD/MM/YYYY - hh:mm a");
 	fechaFinPDF    	= $('#formRangoFecha2').data('DateTimePicker').date.format();
	fechaPDFFin		= moment(fechaFinPDF).format("DD/MM/YYYY - hh:mm a");
	 
    var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
    date.format();
    var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
    date.format();
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                                
                                            },
                        'data'         : { 
                        					'fechaInicio': fechaInicio,
											'fechaFin': fechaFin,
											'numeroOpcionHabilitadaPlataforma' : "4" // seguridad vial 
                        				 }
                      };
	
	// valida si la peticion es de un generador de carga
    if(config.getEsGeneradorCarga()){
		//si la peticion es de un generador de carga entonces a la autenticación se le agrega el codigo de acceso
    	peticion["autenticacion"]["codigoAcceso"] = config.getCodigoAcceso();
    }   
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wsConsultarConduccionContinua' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
    	pintarTablaConduccionContinua(respuesta["data"]);

    });
    request.fail(function(jqXHR, textStatus){ });
};

//--------- Pinta la tabla conduccion continua




//------ Cargar picker de estado de conductor----------------------------------------------------
var pickerTipoConsulta= ["Vehículo", "Conductor"];
function cargarPickerTipoConsulta(idPicker){
	    var totalDatos	= pickerTipoConsulta.length;
	    for (i = 0; i < totalDatos; i++){
			var itemConsulta = pickerTipoConsulta[i];
			$(idPicker).append('<option value="'+i+'">'+itemConsulta+'</option>');
	    }
	    
	    $(idPicker).selectpicker('refresh');
		$(idPicker).selectpicker('deselectAll');
	 	$(idPicker).selectpicker('refresh');
	 	
}

//------ Cargar picker de vehiculos----------------------------------------------------
function cargarPickerVehiculos(idPicker){
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                                
                                            },
                        'data'         : { 
            				"numeroOpcionHabilitadaPlataforma" : "4" //Generadores de carga   
                        				
                        				 }
                      };
 
	// valida si la peticion es de un generador de carga
    if(config.getEsGeneradorCarga()){
		//si la peticion es de un generador de carga entonces a la autenticación se le agrega el codigo de acceso
    	peticion["autenticacion"]["codigoAcceso"] = config.getCodigoAcceso();
    }                      
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wslistVehiculos' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
		    var totalDatos	= respuesta.data.length;
		    for (i = 0; i < totalDatos; i++){
				var itemConsulta = respuesta.data[i].placa;
				$(idPicker).append('<option value="'+respuesta.data[i].idVehiculo+'">'+itemConsulta+'</option>');
		    }
		    $(idPicker).selectpicker('refresh');
			$(idPicker).selectpicker('deselectAll');
		 	$(idPicker).selectpicker('refresh');
		 	cargarTablaEncendidoApagado();
    });
    request.fail(function(jqXHR, textStatus){ });	

	 	
}

// === Document ready!!! =======================================================
$(document).ready(function() {
	// valida si la peticion es de un generador de carga
	if(config.getEsGeneradorCarga()){
		//si la peticion es de un generador de carga entonces muestra el mensaje del rango de fechas definidos por el codigo de acceso
		var fechaDesde = moment(config.getFechaGeneracion()).format("DD/MM/YYYY h:mm a");
		var fechaHasta = moment(config.getFechaCaducidad()).format("DD/MM/YYYY h:mm a");
		$("#textoInfoFechas").text('Habilitado desde '+fechaDesde+ ' hasta '+ fechaHasta);
	}
	var fechaAhora = moment();
	var fechaAnterior = moment().subtract(7, 'days');
	$('.formRangoFecha').datetimepicker(

	        { 	pickTime: true,

	          	showToday: true,
	          	pick12HourFormat: true,
	          	minViewMode: "years",
				minViewMode: "months",
				minViewMode: "days",
				language:'es' });

	$('#formRangoFecha1').data('DateTimePicker').setDate(fechaAnterior);
	$('#formRangoFecha2').data('DateTimePicker').setDate(fechaAhora);
	cargarPickerTipoConsulta('#grupoConsultaAgresiva');
	cargarPickerVehiculos('#grupoConsultaEncendidoApagado');
	cargarTablaConduccionAgresiva();
	cargarTablaPausaActiva();
	cargarTablaConduccionContinua();


//----------------------------------------------------------------------------------------------
//======= Inicio Picker tipo consulta =======		
	$("#grupoConsultaAgresiva").change(function() {
		//click picker
		cargarTablaConduccionAgresiva();
	});	
//======= Fin Picker tipo consulta =======	

//======= Inicio Picker tipo consulta =======		
	$("#grupoConsultaEncendidoApagado").change(function() {
		//click picker
		cargarTablaEncendidoApagado();
	});	
//======= Fin Picker tipo consulta =======	


//=============Modal aceleracion
	$(document).on('click', '.aceleracion', function(){
		var id 	= $(this).parent().find('.id').val();
		var placa 	= $(this).parent().find('.nombre').val();
		$("#formPlaca").text(placa);
		cargarTablaDetalleAceleracion(id);
	});


//=============Modal frenadas
	$(document).on('click', '.frenadas', function(){
		var id 	= $(this).parent().find('.id').val();
		var placa 	= $(this).parent().find('.nombre').val();
		$("#formDatosFrenada").text(placa);
		cargarTablaDetalleFrenadas(id);
	});

//=============Modal movimientos abruptos
	$(document).on('click', '.movimientosAbruptos', function(){
		var id 	= $(this).parent().find('.id').val();
		var placa 	= $(this).parent().find('.nombre').val();
		$("#formDatosMovimientoAbrupto").text(placa);
		cargarTablaDetalleMovimientosAbruptos(id);
	});


//=============Modal excesos de velocidad
	$(document).on('click', '.excesosVelocidad', function(){
		var id 	= $(this).parent().find('.id').val();
		var placa 	= $(this).parent().find('.nombre').val();
		$("#formDatosExcesosVelocidad").text(placa);
		cargarTablaDetalleExcesosVelocidad(id);
	});

//-----------------------------------------------------------------------------------

	// boton filtrar
	$('#formularioConsulta').validator().on('submit', function (e) {
		  if (e.isDefaultPrevented()) {
			notif({
	                msg     : "Invalido campo",
	                type    : "error",
	                position: "center"
	            });
		  } else {
			var permiteAccion =validarFechasUsuario('#formRangoFecha1', '#formRangoFecha2');
		  	 // --------------valida si la peticion es de un generador de carga------------------
		  	var permiteAccionGeneradorCarga = {success: true, tipoFecha: ""}; 	
		    if(config.getEsGeneradorCarga()){
				//si la peticion es de un generador de carga se validan las fechas con las configuradas por un cliente
				var fechaGeneracion = moment(config.getFechaGeneracion());
				var fechaCaducidad  = moment(config.getFechaCaducidad());
				permiteAccionGeneradorCarga = validarFechasGeneradorCarga("#formRangoFecha1", "#formRangoFecha2", "DD/MM/YYYY h:mm a");
				if(permiteAccionGeneradorCarga["tipoFecha"] == "fechaGeneracion"){
					//se le asigna la fecha inicial la fecha de generacion
					$('#formRangoFecha1').data('DateTimePicker').setDate(fechaGeneracion);
					permiteAccionGeneradorCarga["success"] = true;	
				}else if(permiteAccionGeneradorCarga["tipoFecha"] == "fechaCaducidad"){
					//se le asigna la fecha fin la fecha de caducidad
					$('#formRangoFecha2').data('DateTimePicker').setDate(fechaCaducidad);
					permiteAccionGeneradorCarga["success"] = true;
				}
		    }
			if(permiteAccion && permiteAccionGeneradorCarga["success"]){
				//carga la conduccion agresiva
				cargarTablaConduccionAgresiva();
				//carga el encendido y apagagado
				cargarTablaEncendidoApagado();
				// carga tabla Pausa activa
				cargarTablaPausaActiva();
				// carga tabla conduccion continua

				cargarTablaConduccionContinua();

			}		  	
		    e.preventDefault();
		  }
		});

// --- End document ready ------------------------------------------------------

});


</script>

{% endblock %}

{% block contenido %}

<body>
	
	<div id="page-wrapper" style="  margin: 3em; margin-top: 0;">
	
	    <div class="row">
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	    <div class="row">
	        <div class="col-lg-12">
	            <div class="panel panel-default">
	                <!-- /.panel-heading -->
	                <div class="panel-body">
						<div class="tabbable pestana">
							<ul class="nav nav-tabs">
	                                <!--Inicio Fechas-->
	                                	<form data-toggle="validator" role="form" id="formularioConsulta">
	                                		<div class="row">
											   	<div class="col-md-10">
									    			<h3 id="textoInfoFechas"></h3>
									    		</div>
									    	</div>

		                                	<div class="row">
		                                		<div class="col-md-3">
												    <div class="form-group">
										           		<label>Fecha Inicio:</label>
										                <div class="input-group date formRangoFecha" id="formRangoFecha1">
										                  <input id="inputPeriodoGrafico5" type="text" class="form-control" 
										                  		data-date-format="DD/MM/YYYY hh:mm a" data-error="Ingrese una fecha (DD/MM/YYYY hh:mm)"
										                  		pattern="^[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]?[0-9]:[0-9][0-9]\s[(a|A|p|P)][(m|M)]$"
										                  		>
										                  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span>
										                  </span>
										            	</div>
										            	<div class="help-block with-errors"></div>
											        </div>
		                                		</div>
		                                		<div class="col-md-3">
												    <div class="form-group">
										           		<label>Fecha Fin:</label>
										                <div class="input-group date formRangoFecha" id="formRangoFecha2">
										                  <input id="inputPeriodoGrafico6" type="text" class="form-control" 
																data-date-format="DD/MM/YYYY hh:mm a" data-error="Ingrese una fecha (DD/MM/YYYY hh:mm)"
										                  		pattern="^[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]?[0-9]:[0-9][0-9]\s[(a|A|p|P)][(m|M)]$"
										                  		>
										                  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span>
										                  </span>
										            	</div>
										            	<div class="help-block with-errors"></div>
											         </div>
		                                		</div>
		                                		<div class="col-md-2">
												    <div class="form-group">
												    	<label></label>                                	
														<button id="recuperarRutasAudio" type="submit" class="btn btn-raised btn-lg btn-success btn-block ">
															Filtrar
														</button>
													</div>
		                                		</div>
		                                	</div>
	                                	</form>
	  									<!--Fin fechas-->
							    <li class="active"><a href="#1" data-toggle="tab">Conducción agresiva</a></li>
							    <li ><a href="#2" data-toggle="tab">Periodos de encendido y apagado</a></li>
							    <li ><a href="#3" data-toggle="tab">Pausa activa</a></li>
							    <li ><a href="#4" data-toggle="tab">Conducción continua</a></li>	  
						  	</ul>
							<div class="tab-content">
								<!--Inicio Conducción agresiva-->
                                <div class="tab-pane active" id="1">
                                	<div class="row">
                                		<div class="col-md-5">
                                		<h3>Conducción agresiva</h3>
                                		</div>
                                	</div>
					           		<div class="row">
										<div class="col-md-5">
											 <h5 class="bold">Consulta por:</h5>
										 	<div id="selectCarga">
										      <select class="selectpicker" data-width="30%"  data-live-search="true" title="Seleccionar Consulta" 
										      id="grupoConsultaAgresiva" name="grupoConsultaAgresiva">
										      </select>
									    	</div>
										</div>
									</div>
									<div class="row">
										<div class="col-md-12">
								   	 		<table id="tablaConduccionAgresiva" class="table table-striped table-bordered display" style="width: 100%">
				                      		</table>
										   		
										</div>
									</div>
                            	</div>
                                <!--Fin Conducción agresiva-->

                            	<!--Inicio periodos de encendido y apagado-->
                                <div class="tab-pane" id="2">
                                	<div class="row">
                                		<div class="col-md-9">
                                		<h3>Periodos de tiempo (Encendido - apagado)</h3>
                                		</div>
                                	</div>
					           		<div class="row">
										<div class="col-md-5">
											 <h5 class="bold">Vehículo:</h5>
										 	<div id="selectCarga">
										      <select class="selectpicker" data-width="30%"  data-live-search="true" title="Seleccionar Consulta" 
										      id="grupoConsultaEncendidoApagado" name="grupoConsultaEncendidoApagado">
										      </select>
									    	</div>
										</div>
									</div>
									<div class="row">
										<div class="col-md-12">
								   	 		<table id="tablaEncendidoApagado" class="table table-striped table-bordered display" style="width: 100%">
				                      		</table>
										   		
										</div>
									</div>
                                </div>
                                <!--Fin Periodos de encendido y apagado-->
                            	<!--Inicio pausa activa-->
                                <div class="tab-pane" id="3">
                                	<div class="row">
                                		<div class="col-md-5">
                                		<h3>Infracción Pausa activa</h3>
                                		</div>
                                	</div>
									<div class="row">
										<div class="col-md-12">
								   	 		<table id="tablaPausaActiva" class="table table-striped table-bordered display" style="width: 100%">
				                      		</table>
										   		
										</div>
									</div>
                                </div>
                                <!--Fin Pausa activa-->

                            	<!--Inicio conducción continua-->
                                <div class="tab-pane" id="4">
                                	<div class="row">
                                		<div class="col-md-8">
                                		<h3>Infracción Conducción Continua</h3>
                                		</div>
                                	</div>
									<div class="row">
										<div class="col-md-12">
								   	 		<table id="tablaConduccionContinua" class="table table-striped table-bordered display" style="width: 100%">
				                      		</table>
										   		
										</div>
									</div>
                                </div>
                                <!--Fin conducción continua-->								  
                            </div>	
						</div>
					</div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	</div>
<!-- /#page-wrapper -->

<!-- /#MODAL, VENTANA EMERGENTE ACELERACION-->
<div class="modal fade" id="formularioAceleracion" > 
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <div class="row">
        	<h1 class="modal-title">Aceleración</h1>
        </div>
        <div class="row">
        	<h3 class="modal-title" id="formPlaca">Placa</h3>
        </div>	
      </div>
      <div class="modal-body">	
		<div class="row">
			<div class="col-md-12">
	   	 		<table id="tablaDetalleAceleracion" class="table table-striped table-bordered display" style="width: 100%">
	      		</table>
			   		
			</div>
		</div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- /#MODAL, VENTANA EMERGENTE ACELERACION-->


<!-- /#MODAL, VENTANA EMERGENTE FRENADAS-->
<div class="modal fade" id="formularioFrenadas" > 
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <div class="row">
        	<h1 class="modal-title">Frenadas</h1>
        </div>
        <div class="row">
        	<h3 class="modal-title" id="formDatosFrenada">Placa</h3>
        </div>	
      </div>
      <div class="modal-body">	
		<div class="row">
			<div class="col-md-12">
	   	 		<table id="tablaDetalleFrenadas" class="table table-striped table-bordered display" style="width: 100%">
	      		</table>
			</div>
		</div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- /#MODAL, VENTANA EMERGENTE FRENADAS-->


<!-- /#MODAL, VENTANA MOVIMIENTO ABRUPTO-->
<div class="modal fade" id="formularioMovimientosAbruptos" > 
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <div class="row">
        	<h1 class="modal-title">Movimientos Abruptos</h1>
        </div>
        <div class="row">
        	<h3 class="modal-title" id="formDatosMovimientoAbrupto">Placa</h3>
        </div>	
      </div>
      <div class="modal-body">	
		<div class="row">
			<div class="col-md-12">
	   	 		<table id="tablaDetalleMovimientosAbruptos" class="table table-striped table-bordered display" style="width: 100%">
	      		</table>
			</div>
		</div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- /#MODAL, VENTANA MOVIMIENTO ABRUPTO-->

<!-- /#MODAL, VENTANA EXCESOS VELOCIDAD-->
<div class="modal fade" id="formularioExcesosVelocidad" > 
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <div class="row">
        	<h1 class="modal-title">Excesos de Velocidad</h1>
        </div>
        <div class="row">
        	<h3 class="modal-title" id="formDatosExcesosVelocidad">Placa</h3>
        </div>	
      </div>
      <div class="modal-body">	
		<div class="row">
			<div class="col-md-12">
	   	 		<table id="tablaDetalleExcesosVelocidad" class="table table-striped table-bordered display" style="width: 100%">
	      		</table>
			</div>
		</div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- /#MODAL, VENTANA EXCESOS VELOCIDAD-->



</body>


{% endblock %}

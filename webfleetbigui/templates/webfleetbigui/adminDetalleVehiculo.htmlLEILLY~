{% extends baseTemplate %}
{#% extends "webfleetbigui/baseAdminTenant.html" %#}
{% load staticfiles %}
{% block titulo %}Detalle vehículos{% endblock %}

{% block codigoPrincipal %}

<!-- Estilos -->
<link href="{% static "select/css/bootstrap-select.min.css" %}"           rel="stylesheet">
<link href="{% static "css/base.css" %}"  rel="stylesheet">
<link href="{% static "DataTables/datatables.min.css" %}" rel="stylesheet" type="text/css"  />
<link href="{% static "datetimepicker/css/bootstrap-datetimepicker.min.css" %}"           rel="stylesheet">
<link href="{% static "mapsPicker/jquery-gmaps-latlon-picker.css" %}" rel="stylesheet" type="text/css" />
<link href="{% static "bootstrap-player/css/bootstrap3_player.css" %}" rel="stylesheet" type="text/css" />

<!-- Bibliotecas -->
<script src="{% static "select/js/bootstrap-select.min.js" %}"></script>
<script src="{% static "moment/moment-with-locales.js"      %}"></script>
<script src="{% static "nouislider/nouislider.js" %}"   type="text/javascript" ></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/noUiSlider/6.2.0/jquery.nouislider.min.js"></script> -->
<script src="{% static "DataTables/datatables.min.js" %}"   type="text/javascript" ></script>
<script src="{% static "mapsPicker/jquery-gmaps-latlon-picker.js" %}" ></script>
<!--<script src="{% static "socketio/socket.io.js" %}"></script>-->
<script src="{% static "datetimepicker/js/bootstrap-datetimepicker.min.js"      %}"></script>
<script src="{% static "validatorNuevo/validator.js" %}"></script>
<script src="{% static "bootstrap-player/js/bootstrap3_player.js" %}"   type="text/javascript" ></script>
<script src="{% static "mustache/mustache.min.js" %}"   type="text/javascript" ></script>

{% verbatim %}
<script id="templateInfoWindowPosicion" type="x-tmpl-mustache">
 <div class="infoWindowRojo1" >{{direccion}}</div>
 <div style="infoWindowNegro2">{{fechaHora}}</div>
 <div class="infoWindowRojo2">{{velocidad}}Km/h</div>
</script>
{% endverbatim %}

<script>

<<<<<<< HEAD
 //===================== Inicio Detalle vehiculo

 //variables Globales
 var dataRuta = []; //Son los datos de las posiciones de la ruta. 
 var geocoder = null; //Geocoder para preguntar direcciones.

var markerPosicionVehiculoRuta      = null; //Marcador de posición vehiculo
var infoWindowPosicionVehiculoRuta  = null;

var markerPosicionPopup      = null; //Marcador de posición vehiculo
var infoWindowPosicionPopup  = null;

var templateInfoWindowPosicion      = $('#templateInfoWindowPosicion').html();
 //--------------------------------------


 function initMap(){	
     //cargarDatosMapa(3.4206,-76.5222); //con lat y long inicial para establecer el zoom
     //cargarDatosMapa2(3.4206, -76.5222);

 }


 var map2 = null; 
 var beachMarkerOrigen2 = null;
 function cargarDatosMapa2(jsonDataPosicion){
	 if (map2 == null){
	     map2 = new google.maps.Map(document.getElementById('map2'), {
	         center: {lat: parseFloat(jsonDataPosicion.latitud), lng: parseFloat(jsonDataPosicion.longitud)},
	         zoom: 8

	     });
	 }
	 pintarPin2(jsonDataPosicion);
 }


 function pintarPin2(jsonDataPosicion){

	 var latitud  = parseFloat(jsonDataPosicion.latitud);
	 var longitud = parseFloat(jsonDataPosicion.longitud)


	 if(markerPosicionPopup == null){
		 var imageOrigen2 = '{% static "images/pinUbicacion.png" %}';
		 markerPosicionPopup = new google.maps.Marker({         
			 map   : map2,
			 icon  : imageOrigen2,
			 title : "Lat " + latitud + " Long " + longitud			 
		 });

		 google.maps.event.addListener(markerPosicionPopup, 'click', function() {
			 if(infoWindowPosicionPopup != null){
				 infoWindowPosicionPopup.open(map2, this);
			 }
		 });
		 
	 }else{
		 markerPosicionPopup.setMap(map2);
	 }


	 var fecha = moment(jsonDataPosicion.horaRegistrada).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
	 var velocidad      = parseFloat(jsonDataPosicion.velocidad.toFixed(1));
	 
	 var posicionMarker = {lat: latitud, lng: longitud};
     markerPosicionPopup.setPosition(posicionMarker);

	 if(infoWindowPosicionPopup == null){
		 infoWindowPosicionPopup = new google.maps.InfoWindow({
			 content: ''
		 });
	 }else{
		 infoWindowPosicionPopup.close();
	 }
	 
	 
	 if(geocoder == null){
		 geocoder = new google.maps.Geocoder;
	 }

	 geocoder.geocode(
		 {'location': posicionMarker},
		 function(results, status) {
			 var direccion = "";			
			 if (status === 'OK') {
				 if (results[0]) {								   
					 direccion = results[0].formatted_address;
				 } else {
					 direccion = "Dirección no definida";
				 }
			 } else {
				 direccion = "Servicio de dirección no disponible";
			 }

			 var htmlInfoWindow = Mustache.render(templateInfoWindowPosicion,{
				 "direccion" : direccion,
				 "fechaHora" : fecha,
				 "velocidad" : velocidad
			 });
			 
			 infoWindowPosicionPopup.setContent(htmlInfoWindow);
			 infoWindowPosicionPopup.open(map2, markerPosicionPopup);
		 }
	 );
	 
 }

 var zoomGlobal = null;
 var posicionCamaraGlobal = null;
 var usarZoom = false;

 var map1 = null;
 var beachMarkerOrigen = null; //pin
 function cargarDatosMapa(latitud, longitud){
	 //carga los valores iniciales la idea es traer la posicion actual
	 var ruta = [];
	 if(!usarZoom){
		 if (map1 == null){
	    	 map1 = new google.maps.Map(document.getElementById('map1'), {
				 center: {lat: latitud, lng: longitud},
				 zoom: 8

	         });
	     }
	     usarZoom = false;
	 }else{
		 if (map1 == null){
	    	 map1 = new google.maps.Map(document.getElementById('map1'), {
				 center: {lat: latitud, lng: longitud},
				 zoom: zoomGlobal

	         });
	         
	         map1.setCenter(posicionCamaraGlobal);
	     }
	 }

	 markerPosicionVehiculoRuta = new google.maps.Marker({
		 //position: data_destino,
		 //map     : map,
		 icon    : guiImagePuntoControl+"/static/images/pinUbicacion.png",
		 title   : "..."
	 });

	 google.maps.event.addListener(markerPosicionVehiculoRuta, 'click', function() {
		 if(infoWindowPosicionVehiculoRuta != null){
			 infoWindowPosicionVehiculoRuta.open(map1, this);
		 }
	 });

 }

 var ruta = [];
=======
//===================== Inicio Detalle vehiculo

function initMap(){	
    //cargarDatosMapa(3.4206,-76.5222); //con lat y long inicial para establecer el zoom
    cargarDatosMapa2(3.4206, -76.5222);

}


var map2 = null; 
var beachMarkerOrigen2 = null;
function cargarDatosMapa2(latitud, longitud){
		if (map2 == null){
	    	map2 = new google.maps.Map(document.getElementById('map2'), {
	          center: {lat: parseFloat(latitud), lng: parseFloat(longitud)},
	          zoom: 8

	        });
	        //pinta el pin del mapa de la pestana posiciones vehiculo
	        pintarPin2(parseFloat(latitud), parseFloat(longitud));
		}

}


function pintarPin2(latitud, longitud){
	var beachMarkerOrigen2 = null;
	var imageOrigen2 = '{% static "images/pinUbicacion.png" %}';
    beachMarkerOrigen2 = new google.maps.Marker({         
    map: map2,
    icon: imageOrigen2,
    title: "Lat " + latitud + " Long " + longitud

	});
   
    beachMarkerOrigen2.setPosition({lat: latitud, lng: longitud});
  
}

var zoomGlobal = null;
var posicionCamaraGlobal = null;
var usarZoom = false;

var map1 = null;
var beachMarkerOrigen = null; //pin
function cargarDatosMapa(latitud, longitud){
	//carga los valores iniciales la idea es traer la posicion actual
	var ruta = [];
	if(!usarZoom){
		if (map1 == null){
	    	map1 = new google.maps.Map(document.getElementById('map1'), {
	          center: {lat: latitud, lng: longitud},
	          zoom: 8

	        });
	    }
	    usarZoom = false;
	}else{
		if (map1 == null){
	    	map1 = new google.maps.Map(document.getElementById('map1'), {
	          center: {lat: latitud, lng: longitud},
	          zoom: zoomGlobal

	        });
	        
	        map1.setCenter(posicionCamaraGlobal);
	    }


	}

}

var ruta = [];
>>>>>>> origin/masterpuntosdeparada
var heatmap = null;
var rutaPath = null
 function pintarLinea(){

	 if (rutaPath != null){
		 rutaPath.setMap(null);
		 rutaPath = null;
	 }
	 rutaPath = new google.maps.Polyline({
		 path: ruta,
		 geodesic: true,
		 strokeColor: '#FF0000',
		 strokeOpacity: 1.0,
		 strokeWeight: 4
	 });
	 rutaPath.setMap(map1);


	 //Pinta los puntos de calor	
	 heatmap = new google.maps.visualization.HeatmapLayer({
		 data: puntosCalor,
		 map: map1
	 });
	 
 }

 function pintarPin(ultimaPosicion){
	 if(ultimaPosicion == null){
		 map1 = null;
		 cargarDatosMapa(3.4206,-76.5222); //con lat y long inicial para establecer el zoom
		 //cargarDatosMapa();
		 

	 }else{
		 var imageOrigen = '{% static "images/pinUbicacion.png" %}';
	     beachMarkerOrigen = new google.maps.Marker({         
			 map: map1,
			 icon: imageOrigen,
			 title: "Lat " + ultimaPosicion.lat + " Long " + ultimaPosicion.lng

    	 });
		 
         beachMarkerOrigen.setPosition({lat: parseFloat(ultimaPosicion.lat), lng: parseFloat(ultimaPosicion.lng)});

	 }
	 ruta = [];



 }


 function alimentarRuta(dataList){
	 puntosCalor = [];
	 ruta = [];
     for(var i = 0; i < dataList.length ; i++){
    	 var data = dataList[i];
    	 ruta.push({
		     lat: parseFloat(data.latitud),
		     lng: parseFloat(data.longitud)
		 });

		 //Inicio ruta para pintar la linea
		 // ruta.push({
		 //     lat: parseFloat(data.latitud),
		 //     lng: parseFloat(data.longitud)
		 // });
		 //Fin ruta para pintar la linea--------------------------------------
					//puntos para pintar paradas
		 if (data.idFragmentoParada != ""){
			 //esta condicion es para no pintar el mismo punto de calor
			 //del vehiculo 
			 if(parseFloat(data.latitud) != puntoAnteriorLat && parseFloat(data.longitud)!= puntoAnteriorLon){

				 puntosCalor.push(
					 new google.maps.LatLng(parseFloat(data.latitud), parseFloat(data.longitud))
   				 ); 	
			 }
			 puntoAnteriorLat = parseFloat(data.latitud);
			 puntoAnteriorLon = parseFloat(data.longitud);

		 }
	 }
	 pintarLinea();
	 //pintarPin(ruta[ruta.length-1]);				

 }


 //====================================================
 //variables que sirven para guardar el punto anterior
 //para no volver a a pintar la misma parada Nota:Pendiente	
 var puntoAnteriorLat = 0;
 var puntoAnteriorLon = 0;
 //====================================================
 var puntosCalor = [];
 function pintarTablaRutas(data){
	 dataRuta = data;
	 //actualizarSliderFecha();
	 
	 
	 if(data.length>0){
		 //se carga el zoom deacuerdo a la ultima posicion de la busqueda
		 //si se presentan datos para establecer el zoom	
		 cargarDatosMapa(parseFloat(data[data.length -1].latitud),parseFloat(data[data.length -1].longitud)); //con lat y long inicial para establecer el zoom
	 }else{
		 //se carga la posicion actual del vehiculo para estblecer el zoom
		 cargarDatosMapa(3.4206,-76.5222); //con lat y long inicial para establecer el zoom
		 //traerPosicionActualVehiculo();	
	 }
	 alimentarRuta(data);
	 var dataSet = data;
	 if ( ! $.fn.DataTable.isDataTable( '#graficoTabla' ) ) {
	     $('#graficoTabla').DataTable({
	         responsive: true,
	         data: dataSet,
	         fixedHeader:true,
			 
	         "pageLength"	:100,
	         "aaSorting": [],
	         language: traduccionDatatables,
	         columns: [


	             {  title: "Hora registrada",
					data : null
	             },

<<<<<<< HEAD
	             {  title: "Hora recibida",
					data : null
	             },	        
	             {  title: "Latitud",
					data : null   },

	             {  title: "Longitud",
					data : null
	             },

	             {  title: "Acción",
					data : null
	             },

	             {  title: "Velocidad",
					data : null
	             },
	             
	         ],
	         "columnDefs": [
	        	 { responsivePriority: 1, targets: 0 },
	        	 { responsivePriority: 2, targets: 1 },
				 
	      	     {
	      	         "targets": [0],
					 "render": function (data, type, full, meta){
					     var horaRegistrada = "";
					     if( data.horaRegistrada != "" ){
							 horaRegistrada = moment(data.horaRegistrada).format("YYYY-MM-DD h:mm a");
			    		 }
	                     return horaRegistrada;
	                 }
		    	 },
		    	 {
	      	         "targets": [1],
					 "render": function (data, type, full, meta){
					     var horaRecibida = "";
					     if( data.horaRecibida != "" ){
							 horaRecibida = moment(data.horaRecibida).format("YYYY-MM-DD h:mm a");
			    		 }
	                     return horaRecibida;
	                 }
		    	 },

		    	 {
	      	         "targets": [2],
					 "render": function (data, type, full, meta){
					     var latitud = "";
					     if( data.latitud != "" ){
							 latitud = data.latitud;
			    		 }
	                     return latitud;
	                 }
		    	 },

		    	 {
	      	         "targets": [3],
					 "render": function (data, type, full, meta){
					     var longitud = "";
					     if( data.longitud != "" ){

							 longitud = data.longitud;			    		
				    		 
			    		 }
	                     return longitud;
	                 }
		    	 },

		    	 {
	      	         "targets": [4],
					 "render": function (data, type, full, meta){
						 return '<a href="#verPosicion" class="verPosicion" ><img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >Ver Posición</a>'+'<input class="verPosicionData" type="hidden" value="'+JSON.stringify(data).replace(/"/g, '&quot;')+'" />';
	                 }
		    	 },
		    	 
		    	 {
	      	         "targets": [5],
					 "render": function (data, type, full, meta){
					     var velocidad = "";
					     if( data.velocidad != "" ){
							 velocidad = data.velocidad;
			    		 }
	                     return velocidad;
	                 }
		    	 },


	         ]

	     });

	     
	 }   
	 else{
		 $('#graficoTabla').DataTable().clear().rows.add(dataSet).draw();
		 
	 }

	 reiniciarSlider()
	 
 }
=======
	}else{
		var imageOrigen = '{% static "images/pinUbicacion.png" %}';
	    beachMarkerOrigen = new google.maps.Marker({         
        map: map1,
        icon: imageOrigen,
        title: "Lat " + ultimaPosicion.lat + " Long " + ultimaPosicion.lng

    	});
       
        beachMarkerOrigen.setPosition({lat: parseFloat(ultimaPosicion.lat), lng: parseFloat(ultimaPosicion.lng)});

	}
	ruta = [];



}


function alimentarRuta(dataList){
	puntosCalor = []
    for(var i = 0; i < dataList.length ; i++){
    	var data = dataList[i];
    	ruta.push({
		    	lat: parseFloat(data.latitud),
		    	lng: parseFloat(data.longitud)
			});

			//Inicio ruta para pintar la linea
			ruta.push({
		    	lat: parseFloat(data.latitud),
		    	lng: parseFloat(data.longitud)
			});
			//Fin ruta para pintar la linea--------------------------------------
		//puntos para pintar paradas
			if (data.idFragmentoParada != ""){
				//esta condicion es para no pintar el mismo punto de calor
				//del vehiculo 
				if(parseFloat(data.latitud) != puntoAnteriorLat && parseFloat(data.longitud)!= puntoAnteriorLon){

					puntosCalor.push(
					new google.maps.LatLng(parseFloat(data.latitud), parseFloat(data.longitud))
   						 ); 	
				}
					puntoAnteriorLat = parseFloat(data.latitud);
					puntoAnteriorLon = parseFloat(data.longitud);

			}
	}
	pintarLinea();
	pintarPin(ruta[ruta.length-1]);				

}


//====================================================
//variables que sirven para guardar el punto anterior
//para no volver a a pintar la misma parada Nota:Pendiente	
var puntoAnteriorLat = 0;
var puntoAnteriorLon = 0;
//====================================================
var puntosCalor = [];
function pintarTablaRutas(data){
	if(data.length>0){
		//se carga el zoom deacuerdo a la ultima posicion de la busqueda
		//si se presentan datos para establecer el zoom	
		cargarDatosMapa(parseFloat(data[data.length -1].latitud),parseFloat(data[data.length -1].longitud)); //con lat y long inicial para establecer el zoom
	}else{
		//se carga la posicion actual del vehiculo para estblecer el zoom
		cargarDatosMapa(3.4206,-76.5222); //con lat y long inicial para establecer el zoom
		traerPosicionActualVehiculo();	
	}
	alimentarRuta(data);
	var dataSet = data;
	
	if ( ! $.fn.DataTable.isDataTable( '#graficoTabla' ) ) {
		
	    $('#graficoTabla').DataTable({
	        responsive: true,
	        data: dataSet,
	        fixedHeader:true,
	        
	       
	        "pageLength"	:100,
	        "aaSorting": [],
	        language: traduccionDatatables,
	        columns: [


	            {  title: "Hora registrada",
	               data : null
	            },

	            {  title: "Hora recibida",
	               data : null
	            },	        
	            {  title: "Latitud",
	               data : null   },

	            {  title: "Longitud",
	               data : null
	            },

	            {  title: "Acción",
	               data : null
	            },

	            {  title: "Velocidad (Km/h)",
	               data : null
	            },
	            
	        ],
	        "columnDefs": [
	        	{ responsivePriority: 1, targets: 0 },
	        	{ responsivePriority: 2, targets: 1 },
	           
	      	    {
	      	        "targets": [0],
					"render": function (data, type, full, meta){
					    var horaRegistrada = "";
					    if( data.horaRegistrada != "" ){
							horaRegistrada = moment(data.horaRegistrada).format("YYYY-MM-DD h:mm a");
			    		}
	                    return horaRegistrada;
	                }
		    	},
		    	{
	      	        "targets": [1],
					"render": function (data, type, full, meta){
					    var horaRecibida = "";
					    if( data.horaRecibida != "" ){
							horaRecibida = moment(data.horaRecibida).format("YYYY-MM-DD h:mm a");
			    		}
	                    return horaRecibida;
	                }
		    	},

		    	{
	      	        "targets": [2],
					"render": function (data, type, full, meta){
					    var latitud = "";
					    if( data.latitud != "" ){
							latitud = data.latitud;
			    		}
	                    return latitud;
	                }
		    	},

		    	{
	      	        "targets": [3],
					"render": function (data, type, full, meta){
					    var longitud = "";
					    if( data.longitud != "" ){

							longitud = data.longitud;			    		
				    		
			    		}
	                    return longitud;
	                }
		    	},

		    	{
	      	        "targets": [4],
					"render": function (data, type, full, meta){
					return '<a href="#verPosicion" class="verPosicion" ><img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >Ver Posición</a>'+'<input class="verPosicionData" type="hidden" value="'+JSON.stringify(data).replace(/"/g, '&quot;')+'" />';
	                }
		    	},
		    	
		    	{
	      	        "targets": [5],
					"render": function (data, type, full, meta){
					    var velocidad = "";
					    if( data.velocidad != "" ){
							//velocidad = data.velocidad;
							velocidad = parseFloat(data.velocidad).toFixed(1);
			    		}
	                    return velocidad;
	                }
		    	},


	        ]

	    });
		
		 
	     
	 }   
	 else{
	 	
		$('#graficoTabla').DataTable().clear().rows.add(dataSet).draw();
		
	}

	
}


//------ Cargar Tabla listado de vehiculos----------------------------------------------------
function cargarTablaRutas(){
    var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
    date.format();
    var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
    date.format();
    /*
	var fechaInicio = "2016-07-26T12:55";
	var fechaFin = "2016-07-25T12:55";
   	*/
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                            },
                        'data'         : { 
                        					'fechaInicio': fechaInicio,
                        					'fechaFin': fechaFin,
                        					'id': "{{idVehiculo}}"
                        				 }
                      };
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wsposicionVehiculoRangoFecha' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
    	pintarTablaRutas(respuesta["data"]);

    });
    request.fail(function(jqXHR, textStatus){ });
};


function traerDatosVehiculo(){
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                              
                                            },
                        'data'         : { 
                        					'id': "{{idVehiculo}}",
                        				 }
                      };
    var request = $.ajax({
		            type        : "POST",
		            url         : "{% url 'wslistarDetalleVehiculo' %}",
		            data        : {
                        request :  JSON.stringify(peticion)
                    },
		            dataType    : "json"

		        }).done(function(respuesta){
                	if (respuesta.success){
                        cargarDatosDetalleVehiculo(respuesta.data);
                       }
                       else{
                       	notif({
                            msg     : respuesta.mensaje,
                            type    : "error",
                            position: "center"
                        });
                       }
                }).fail(function(jqXHR, textStatus){
                    notif({
                        msg     : "Falló la conexión",
                        type    : "error",
                        position: "center"
                    });
                }).always(function(){
                });
}


var numPlaca;
function cargarDatosDetalleVehiculo(data){

	//DATOS GENERALES
	numPlaca= data.placa;
	$("#vehiculoPlaca").text(data.placa);
	$("#vehiculoMarca").text(data.marca);
	$("#vehiculoModelo").text(data.modelo);
	$("#vehiculoImei").text(data.imeiGps);
	$("#vehiculoSimcard").text(data.numSimCard);
	$("#vehiculoTipo").text(data.tipoGps);

    var idConductor			= data.conductor;
    var total				= conductores.length;
	if (idConductor == ""){
    	//$('#grupoConductor').append('<option value="'+total+'"> Sin conductor </option>');
    	$('#grupoConductor > option[value="'+total+'"]').attr('selected', 'selected');
    	
    	var posicion    = conductores.length;
    	$('#grupoConductor')	.val(posicion);
    	$('#grupoConductor')  .selectpicker('refresh');
    }
    else{
    	for(var i=0; i<conductores.length;i++){
    		var datoConductor		= conductores[i];
    		//alert(datoConductor.id)
    		var id			= datoConductor.id;
    		if(id == idConductor){
    			$('#grupoConductor')	.val(i);
    			$('#grupoConductor').selectpicker('refresh');
    		}
    	    		
    	}
    	
    }

  	if(data.cargado){
  		$('#grupoCarga > option[value="'+0+'"]').attr('selected', 'selected');
  	}else{
  		$('#grupoCarga > option[value="'+1+'"]').attr('selected', 'selected');
  	}
	$('#grupoCarga')  .selectpicker('refresh');

}


//--------- Cargar tabla con las paradaVehiculo editando

function pintarTablaParadas(data){
	var dataSet = data;
	
	if ( ! $.fn.DataTable.isDataTable( '#TablaParadas' ) ) {
		$('#TablaParadas').DataTable({
	        responsive: true,
	        data: dataSet,
	        fixedHeader: true,
	       
	        "pageLength"	:100,
	        "aaSorting": [],
	        language: traduccionDatatables,
	        columns: [
	            {  title: "Fecha hora inicio",
	               data : null
	            },

	            {  title: "Fecha Hora Fin",
	               data : null
	            },	
	            
	            {  title: "Duración parada",
	               data : null
	            },	        
	            {  title: "Latitud",
	               data : null   },

	            {  title: "Longitud",
	               data : null
	            },

	            {  title: "Acción",
	               data : null
	            },
	            
	        ],
	        "columnDefs": [
	        	{ responsivePriority: 1, targets: 0 },
	        	{ responsivePriority: 2, targets: 1 },
	           
	      	    {
	      	        "targets": [0],
					"render": function (data, type, full, meta){
					    var fechahoraInicio = "";
					    if( data.fechahoraInicio != "" ){
							fechahoraInicio = moment(data.fechahoraInicio).format("YYYY-MM-DD h:mm a");
			    		}
	                    return fechahoraInicio;
	                }
		    	},
		    	{
	      	        "targets": [1],
					"render": function (data, type, full, meta){
					    var fechahoraFin = "";
					    if( data.fechahoraFin != "" ){
							fechahoraFin = moment(data.fechahoraFin).format("YYYY-MM-DD h:mm a");
			    		}
	                    return fechahoraFin;
	                }
		    	},
		    	{
	      	        "targets": [2],
					"render": function (data, type, full, meta){
					    var tiempo = "";
					    if(data.fechahoraInicio && data.fechahoraFin != "" ){
					    	var fechahoraInicio 	= moment(data.fechahoraInicio);
							var fechahoraFin	 	= moment(data.fechahoraFin);
		 
							 var diferenciaSegundos 					= fechahoraFin.diff(fechahoraInicio,'seconds');
							 var diferenciaMinutos  					= fechahoraFin.diff(fechahoraInicio,'minutes');
							 var diferenciaHours    					= fechahoraFin.diff(fechahoraInicio,'hours');
    			 
			    			 var segundos 							= diferenciaSegundos;
			    			 
			    			 var minutos  = parseInt(segundos / 60);
							 var horas    = parseInt(segundos/(60*60));
							 var dias     = parseInt(segundos/(60*60*24));
							 
							 var texto ="";
							 if(segundos < 60){
							 	if (segundos==1){
							 		texto = "1 Segundo";
							 	}
							 	else{
							 		texto = segundos+" Segundos";
							 	}
								 
							 }else if(minutos < 60){
							 	if (minutos==1){
							 		texto = "1 Minuto";
							 	}
							 	else{
							 		texto = minutos+" Minutos";
							 	}
								 
							 }else if(horas < 24){
								 var minutosResiduo = parseInt((segundos/60) % 60);
								 texto = horas+"h "+minutosResiduo+"min";
							 }else{
							 	var horasResiduo = parseInt((minutos/60) % 24);
							 	if(dias==1){
							 		 texto = dias+"día "+horasResiduo+"h";
							 	}
							 	else{
							 		texto = dias+"días "+horasResiduo+"h";
							 	}
							 	 
							 }
							 
							 tiempo 		= texto;
							
			    		}
	                    return tiempo;
	                }
		    	},

		    	{
	      	        "targets": [3],
					"render": function (data, type, full, meta){
					    var latitud = "";
					    if( data.latitud != "" ){
							latitud = data.latitud;
			    		}
	                    return latitud;
	                }
		    	},

		    	{
	      	        "targets": [4],
					"render": function (data, type, full, meta){
					    var longitud = "";
					    if( data.longitud != "" ){
							longitud = data.longitud;
			    		}
	                    return longitud;
	                }
		    	},

		    	{
	      	        "targets": [5],
					"render": function (data, type, full, meta){
					return '<a href="#verPosicion" class="verPosicion" ><img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >Ver Posición</a>'+'<input class="verPosicionData" type="hidden" value="'+JSON.stringify(data).replace(/"/g, '&quot;')+'" />';
	                }
		    	},
			

	        ]
	        
	    });
	   
	 }   
	 else{
		$('#TablaParadas').DataTable().clear().rows.add(dataSet).draw();
		
	}
}


function cargarTablaParadas(){
    var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
    date.format();
    var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
    date.format();
    /*
	var fechaInicio = "2016-07-26T12:55";
	var fechaFin = "2016-07-25T12:55";
   	*/
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                                
                                            },
                        'data'         : { 
                        					'fechaInicio': fechaInicio,
                        					'fechaFin'		: fechaFin,
                        					'id'	: "{{idVehiculo}}",
                        				 }
                      };
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wslistarParadaVehiculo' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
        if(respuesta.success){
            pintarTablaParadas(respuesta["data"]);
        }else{ }
    });
    request.fail(function(jqXHR, textStatus){ });
};
 
>>>>>>> origin/masterpuntosdeparada


 //------ Cargar Tabla listado de vehiculos----------------------------------------------------
 function cargarTablaRutas(){
     var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').date.format();
     var fechaFin    = $('#formRangoFecha2').data('DateTimePicker').date.format();

	 $("#fechaSlider").text($('#formRangoFecha2').data('DateTimePicker').date.format("DD/MM/YYYY hh:mm a"));

	 
     /*
		var fechaInicio = "2016-07-26T12:55";
		var fechaFin = "2016-07-25T12:55";
   	  */
	 var peticion    = {
		 'autenticacion' : {
			 'usuario' : config.getUsuarioLogin(),
             'token'   : config.getToken(),
             'tenant'  : config.getTennant(),                                             
		 },
         'data'         : { 
             'fechaInicio' : fechaInicio,
             'fechaFin'    : fechaFin,
             'id'          : "{{idVehiculo}}"
         }
     };
	 
     var request = $.ajax({
         type : "POST",
         url  : "{% url 'wsposicionVehiculoRangoFecha' %}",
         data : {
             request: JSON.stringify(peticion)
         },
         dataType: "json"
     });
	 
     request.done(function(respuesta){
    	 pintarTablaRutas(respuesta["data"]);
     });
	 
     request.fail(function(jqXHR, textStatus){ });
 };


 function traerDatosVehiculo(){
	 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                             'token'   : config.getToken(),
                                             'tenant'  : config.getTennant(),
                                             
     },
                         'data'         : { 
                        	 'id': "{{idVehiculo}}",
                         }
     };
     var request = $.ajax({
		 type        : "POST",
		 url         : "{% url 'wslistarDetalleVehiculo' %}",
		 data        : {
             request :  JSON.stringify(peticion)
         },
		 dataType    : "json"

	 }).done(function(respuesta){
         if (respuesta.success){

             cargarDatosDetalleVehiculo(respuesta.data);
         }
         else{
             notif({
                 msg     : respuesta.mensaje,
                 type    : "error",
                 position: "center"
             });
         }
     }).fail(function(jqXHR, textStatus){
         notif({
             msg     : "Falló la conexión",
             type    : "error",
             position: "center"
         });
     }).always(function(){
     });
 }


 var numPlaca;
 function cargarDatosDetalleVehiculo(data){

	 //DATOS GENERALES
	 numPlaca= data.placa;
	 $("#vehiculoPlaca").text(data.placa);
	 $("#vehiculoMarca").text(data.marca);
	 $("#vehiculoModelo").text(data.modelo);
	 $("#vehiculoImei").text(data.imeiGps);
	 $("#vehiculoSimcard").text(data.numSimCard);
	 $("#vehiculoTipo").text(data.tipoGps);

     var idConductor			= data.conductor;
     var total				= conductores.length;
	 if (idConductor == ""){
    	 //$('#grupoConductor').append('<option value="'+total+'"> Sin conductor </option>');
    	 $('#grupoConductor > option[value="'+total+'"]').attr('selected', 'selected');
    	 
    	 var posicion    = conductores.length;
    	 $('#grupoConductor')	.val(posicion);
    	 $('#grupoConductor')  .selectpicker('refresh');
     }
     else{
    	 for(var i=0; i<conductores.length;i++){
    		 var datoConductor		= conductores[i];
    		 //alert(datoConductor.id)
    		 var id			= datoConductor.id;
    		 if(id == idConductor){
    			 $('#grupoConductor')	.val(i);
    			 $('#grupoConductor').selectpicker('refresh');
    		 }
    	     
    	 }
    	 
     }

  	 if(data.cargado){
  		 $('#grupoCarga > option[value="'+0+'"]').attr('selected', 'selected');
  	 }else{
  		 $('#grupoCarga > option[value="'+1+'"]').attr('selected', 'selected');
  	 }
	 $('#grupoCarga')  .selectpicker('refresh');

 }


 //--------- Cargar tabla con las paradaVehiculo editando

 function pintarTablaParadas(data){
	 var dataSet = data;

	 if ( ! $.fn.DataTable.isDataTable( '#TablaParadas' ) ) {
	     $('#TablaParadas').DataTable({
	         responsive: true,
	         data: dataSet,
	         fixedHeader:true,
			 
	         "pageLength"	:100,
	         "aaSorting": [],
	         language: traduccionDatatables,
	         columns: [
	             {  title: "Fecha hora inicio",
					data : null
	             },

	             {  title: "Fecha Hora Fin",
					data : null
	             },	        
	             {  title: "Latitud",
					data : null   },

	             {  title: "Longitud",
					data : null
	             },

	             {  title: "Acción",
					data : null
	             },
	             
	         ],
	         "columnDefs": [
	        	 { responsivePriority: 1, targets: 0 },
	        	 { responsivePriority: 2, targets: 1 },
				 
	      	     {
	      	         "targets": [0],
					 "render": function (data, type, full, meta){
					     var fechahoraInicio = "";
					     if( data.fechahoraInicio != "" ){
							 fechahoraInicio = moment(data.fechahoraInicio).format("YYYY-MM-DD h:mm a");
			    		 }
	                     return fechahoraInicio;
	                 }
		    	 },
		    	 {
	      	         "targets": [1],
					 "render": function (data, type, full, meta){
					     var fechahoraFin = "";
					     if( data.fechahoraFin != "" ){
							 fechahoraFin = moment(data.fechahoraFin).format("YYYY-MM-DD h:mm a");
			    		 }
	                     return fechahoraFin;
	                 }
		    	 },

		    	 {
	      	         "targets": [2],
					 "render": function (data, type, full, meta){
					     var latitud = "";
					     if( data.latitud != "" ){
							 latitud = data.latitud;
			    		 }
	                     return latitud;
	                 }
		    	 },

		    	 {
	      	         "targets": [3],
					 "render": function (data, type, full, meta){
					     var longitud = "";
					     if( data.longitud != "" ){
							 longitud = data.longitud;
			    		 }
	                     return longitud;
	                 }
		    	 },

		    	 {
	      	         "targets": [4],
					 "render": function (data, type, full, meta){
						 return '<a href="#verPosicion" class="verPosicion" ><img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >Ver Posición</a>'+'<input class="verPosicionData" type="hidden" value="'+JSON.stringify(data).replace(/"/g, '&quot;')+'" />';
	                 }
		    	 },


	         ]
	     });
	 }   
	 else{
		 $('#TablaParadas').DataTable().clear().rows.add(dataSet).draw();
		 
	 }
 }


 function cargarTablaParadas(){
     var fechaInicio = $('#formRangoFecha1').data('DateTimePicker').
											 date.format();
     var fechaFin = $('#formRangoFecha2').data('DateTimePicker').
										  date.format();
     /*
		var fechaInicio = "2016-07-26T12:55";
		var fechaFin = "2016-07-25T12:55";
   	  */
	 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                             'token'   : config.getToken(),
                                             'tenant'  : config.getTennant(),
                                             
     },
                         'data'         : { 
                        	 'fechaInicio': fechaInicio,
                        	 'fechaFin'		: fechaFin,
                        	 'id'	: "{{idVehiculo}}",
                         }
     };
	 
     var request = $.ajax({
         type: "POST",
         url		: "{% url 'wslistarParadaVehiculo' %}",
         data	: {
             request: JSON.stringify(peticion)
         },
         dataType: "json"
     });
     request.done(function(respuesta){
         if(respuesta.success){
             pintarTablaParadas(respuesta["data"]);
         }else{ }
     });
     request.fail(function(jqXHR, textStatus){ });
 };
 

<<<<<<< HEAD
 $(document).on('click', '.verPosicion', function(){
	 //Limpia el div del mapa
	 $(".map2").html("");
   	 map2 = null;
  	 //map1 = null; 
  	 $('#detailModal').modal('show');
  	 $('#contenedorMapa2').show();
   	 var data = $(this).parent().find(".verPosicionData").val();
   	 var jsonData = JSON.parse(data);
	 setTimeout(function(){
		 
		 //cargarDatosMapa2(jsonData.latitud, jsonData.longitud);
		 cargarDatosMapa2(jsonData);	

	 }, 1000);

 });


 function traerPosicionActualVehiculo(){
	 //funcion que trae la posicion actual del vehiculo y su estado("activo o inactivo")
	 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                             'token'   : config.getToken(),
                                             'tenant'  : config.getTennant(),
                                             
     },
                         'data'         : { 
                        	 'id': "{{idVehiculo}}",
                         }
     };
     var request = $.ajax({
		 type        : "POST",
		 url         : "{% url 'wsultimaPosicionVehiculo' %}",
		 data        : {
             request :  JSON.stringify(peticion)
         },
		 dataType    : "json"

	 }).done(function(respuesta){
         if (respuesta.success){

             pintarPinPosicionActual(respuesta.data);
         }
         else{
             notif({
                 msg     : respuesta.mensaje,
                 type    : "error",
                 position: "center"
             });
         }
     }).fail(function(jqXHR, textStatus){
         notif({
             msg     : "Falló la conexión",
             type    : "error",
             position: "center"
         });
     }).always(function(){
     });
 }


 function pintarPinPosicionActual(data){
	 if(data.estado == "activo"){
		 var imageOrigen = '{% static "images/pinUbicacion.png" %}';
	 }else
	 if(data.estado == "inactivo"){
		 var imageOrigen = '{% static "images/pinDesactivado.png" %}';
	 }
	 var beachMarkerOrigen = null;
     if (beachMarkerOrigen == null){
		 
	     beachMarkerOrigen = new google.maps.Marker({         
			 map: map1,
			 icon: imageOrigen,
			 title: " Posicion actual. "+"Lat " + data.latitud + " Long " + data.longitud

    	 });
		 
         beachMarkerOrigen.setPosition({lat: parseFloat(data.latitud), lng: parseFloat(data.longitud)});
     }	
 }
 //===================== Fin Detalle vehiculo==============================


 //==================== Inicio imagenes vehículo===========================


 function pintarTablaRutasCapturaImagen(data){
	 var dataSet = data;
	 if ( ! $.fn.DataTable.isDataTable( '#graficoTabla2' ) ) {
	     $('#graficoTabla2').DataTable({
	         responsive: true,
	         data: dataSet,
	         fixedHeader:true,	       
	         "pageLength"	:100,
	         "aaSorting": [],
	         language: traduccionDatatables,
	         columns: [

	             {  title: "Hora registrada",
					data : null
	             },
				 
	             {  title: "Latitud",
					data : null   },
=======
        	 }
    });
    request.fail(function(jqXHR, textStatus){ });
}


//------ Cargar picker de estado de carga----------------------------------------------------

var estadoCarga = ["Con carga", "Sin carga"];
function cargarPickerEstadoCarga(data){
	    var totalDatos	= estadoCarga.length;
	    for (i = 0; i < totalDatos; i++){
			var itemCarga = estadoCarga[i];
			$('#grupoCarga').append('<option value="'+i+'">'+itemCarga+'</option>');
	    }
	    
	    $('#grupoCarga').selectpicker('refresh');
		$('#grupoCarga').selectpicker('deselectAll');
	 	$('#grupoCarga').selectpicker('refresh');
	 	
}

function actualizarEstadoCarga(estaCargado){
	var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                            'token'   : config.getToken(),
                                            'tenant'  : config.getTennant(),
                                            },
                        'data'         : {  
                        					'idVehiculo' : "{{idVehiculo}}",
                        					'cargado': estaCargado
                        				 }
                      };
	
    var request = $.ajax({
            type: "POST",
            url		: "{% url 'wsActualizarEstadoCarga' %}",
            data	: {
                        request: JSON.stringify(peticion)
             },
             dataType: "json"
        });
    request.done(function(respuesta){
        if(respuesta.success){
            notif({
                    msg     : "El estado de carga fue actualizado",
                    type    : "success",
                    position: "center"
                });    
        }else{
        	notif({
                    msg     : "Error al actualizar",
                    type    : "error",
                    position: "center"
                });
        	 }
    });
    request.fail(function(jqXHR, textStatus){ });
}



//==============================================================================
// === Document ready!!! =======================================================
$(document).ready(function() {
	cargarPickerEstadoCarga();

//======= Inicio Picker conductores =======	
	traerConductores();
	$("#grupoConductor").change(function() {
		//click picker
		$('#formularioAceptarAsignar').modal('show');
	});	

	$(document).on('click', '#aceptarAsignarConductor', function(){
		var posicion = $('#grupoConductor')	.val();
        if(!(posicion == conductores.length)){
 			var datoConductor = conductores[posicion];
 			idConductor		  = datoConductor.id;
 			verificarConductorAsignado(idConductor);
 		}else{
 			idConductor = "";
 			asignarConductorVehiculo(idConductor);

 		}	
	});	
	
	$(document).on('click', '#aceptarAsignarConductorForzado', function(){
		var posicion = $('#grupoConductor')	.val();
        if(!(posicion == conductores.length)){
 			var datoConductor = conductores[posicion];
 			idConductor		= datoConductor.id;
			reAsignarConductorVehiculo(idConductor);
 		}else{
 			idConductor = "";
 			asignarConductorVehiculo(idConductor);
 		}		
	});   
>>>>>>> origin/masterpuntosdeparada

	             {  title: "Longitud",
					data : null
	             }, 

	             {  title: "Acción",
					data : null
	             },

	             {  title: "Imágen",
					data : null
	             }, 

	             {  title: "",
					data : null
	             },        
	         ],
	         "columnDefs": [
	        	 { responsivePriority: 1, targets: 0 },
	        	 { responsivePriority: 2, targets: 1 },
				 
	      	     {
	      	         "targets": [0],
					 "render": function (data, type, full, meta){
					     var horaRegistrada = "";
					     if( data.horaRegistrada != "" ){
							 horaRegistrada = moment(data.horaRegistrada).format("YYYY-MM-DD h:mm a");
			    		 }
	                     return horaRegistrada;
	                 }
		    	 },

		    	 {
	      	         "targets": [1],
					 "render": function (data, type, full, meta){
					     var latitud = "";
					     if( data.latitud != "" ){
							 latitud = data.latitud;
			    		 }
	                     return latitud;
	                 }
		    	 },

		    	 {
	      	         "targets": [2],
					 "render": function (data, type, full, meta){
					     var longitud = "";
					     if( data.longitud != "" ){
							 longitud = data.longitud;
			    		 }
	                     return longitud;
	                 }
		    	 },
		    	 
		    	 {
	      	         "targets": [3],
					 "render": function (data, type, full, meta){
						 return '<a href="#verPosicion" class="verPosicion" ><img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >Ver Posición</a>'+'<input class="verPosicionData" type="hidden" value="'+JSON.stringify(data).replace(/"/g, '&quot;')+'" />';
	                 }
		    	 },

		    	 {
	      	         "targets": [4],
					 "render": function (data, type, full, meta){
					     var urlImagen = "";
					     if( data.urlImagen != "" ){
							 urlImagen = data.urlImagen;
			    		 }
						 return '<img src="'+data.urlImagen+'_thumbnail'+'">';
	                 }
		    	 },


		    	 {
	      	         "targets": [5],
					 "render": function (data, type, full, meta){
					     var urlImagen = "";
					     var horaRegistrada = "";
					     if( data.urlImagen != "" && data.horaRegistrada != "" ){
							 urlImagen = data.urlImagen;
					  		 moment(data.horaRegistrada).format(); 
							 horaRegistrada = moment().format("YYYY-MM-DD h:mm a");
			    		 }
						 return '<a download= "'+numPlaca+"#"+horaRegistrada+'" href="'+urlImagen+'" title="'+numPlaca+"#"+horaRegistrada+'"> <i class="fa fa-arrow-circle-down" aria-hidden="true"></i> Descargar imagen</a>';
						 

	                 }
		    	 },

	         ]
	     });
	 }   
	 else{
		 $('#graficoTabla2').DataTable().clear().rows.add(dataSet).draw();
		 
	 }
 }



 //------ Cargar Tabla listado rutas con imagen----------------------------------------------------
 function cargarTablaRutasCapturaImagen(){
     var fechaInicio = $('#formRangoFecha1Imagenes').data('DateTimePicker').
													 date.format();
     var fechaFin = $('#formRangoFecha2Imagenes').data('DateTimePicker').
												  date.format();
     /*
		var fechaInicio = "2016-07-26T12:55";
		var fechaFin = "2016-07-25T12:55";
   	  */
	 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                             'token'   : config.getToken(),
                                             'tenant'  : config.getTennant(),
                                             
     },
                         'data'         : { 
                        	 'fechaInicio': fechaInicio,
                        	 'fechaFin': fechaFin,
                        	 'id': "{{idVehiculo}}"
                         }
     };
	 
     var request = $.ajax({
         type: "POST",
         url		: "{% url 'wsvehiculoRangoFechaCapturaImagen' %}",
         data	: {
             request: JSON.stringify(peticion)
         },
         dataType: "json"
     });
     request.done(function(respuesta){
         if(respuesta.success){
             pintarTablaRutasCapturaImagen(respuesta["data"]);
         }else{ }
     });
     request.fail(function(jqXHR, textStatus){ });
 };

 //===========================Fin Imagenes vehículo ==================================


 //===========================Inicio audio vehículo ==================================

 function convertirFormatoAudio(duracion){
	 var tiempo = parseInt(duracion);
	 var horas = parseInt(tiempo/3600);
	 var minutos = parseInt((tiempo - (horas*3600)) / 60);
	 var segundos = tiempo -((horas * 3600) +(minutos * 60));
	 return horas.toString() + " h " + minutos.toString() + " min " + segundos.toString()+" segs";

 }

 function pintarTablaRutasCapturaAudio(data){
	 var dataSet = data;

	 if ( ! $.fn.DataTable.isDataTable( '#graficoTabla3' ) ) {
	     $('#graficoTabla3').DataTable({
	         responsive: true,
	         data: dataSet,
	         fixedHeader:true,	       
	         "pageLength"	:100,
	         "aaSorting": [],
	         language: traduccionDatatables,
	         columns: [

	             {  title: "Hora registrada",
					data : null
	             },
				 
	             {  title: "Latitud",
					data : null   },

	             {  title: "Longitud",
					data : null
	             },

	             {  title: "Acción",
					data : null
	             }, 	            

	             {  title: "Duración",
					data : null
	             }, 	            

	             {  title: "Audios",
					data : null
	             },     
	         ],
	         "columnDefs": [
	        	 { responsivePriority: 1, targets: 0 },
	        	 { responsivePriority: 2, targets: 1 },
				 
	      	     {
	      	         "targets": [0],
					 "render": function (data, type, full, meta){
					     var horaRegistrada = "";
					     if( data.horaRegistrada != "" ){
							 horaRegistrada = moment(data.horaRegistrada).format("YYYY-MM-DD h:mm a");
			    		 }
	                     return horaRegistrada;
	                 }
		    	 },

		    	 {
	      	         "targets": [1],
					 "render": function (data, type, full, meta){
					     var latitud = "";
					     if( data.latitud != "" ){
							 latitud = data.latitud;
			    		 }
	                     return latitud;
	                 }
		    	 },

		    	 {
	      	         "targets": [2],
					 "render": function (data, type, full, meta){
					     var longitud = "";
					     if( data.longitud != "" ){
							 longitud = data.longitud;
			    		 }
	                     return longitud;
	                 }
		    	 },

		    	 {
	      	         "targets": [3],
					 "render": function (data, type, full, meta){
						 return '<a href="#verPosicion" class="verPosicion" ><img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >Ver Posición</a>'+'<input class="verPosicionData" type="hidden" value="'+JSON.stringify(data).replace(/"/g, '&quot;')+'" />';
	                 }
		    	 },
		    	 
		    	 {
	      	         "targets": [4],
					 "render": function (data, type, full, meta){
						 var tiempo = 0;
					     var duracion = "";
					     if( data.duracion != ""){
							 duracion = data.duracion;
						     var resultado = convertirFormatoAudio(duracion);
						     if(data.duracion!= null){
						    	 duracion = resultado;
						     }else{
						    	 duracion = "0 h 0 min 0 segs"	
						     }
			    		 }
			    		 return duracion;
	                 }
		    	 },
		    	 
		    	 {
	      	         "targets": [5],
					 "render": function (data, type, full, meta){
						 var urlAudio = "";	
						 if(data.urlAudio!= ""){
							 urlAudio = data.urlAudio;
							 return '<audio controls>'+
									'<source src="'+urlAudio+'" type="audio/wav" />'+
									'<a href="'+urlAudio+'">Descarga</a>'+
									'</audio>';
						 }
						 else{
							 return urlAudio;
						 }

						 /*return '<a href="'+urlAudio+'" class="botonReproductor"><img src="{% static "images/play.png" %} " class="imagenPlay">Reproducir</a>';*/
	                 }
		    	 },

	         ]
	     });
	 }   
	 else{
		 $('#graficoTabla3').DataTable().clear().rows.add(dataSet).draw();
		 
	 }
 }


 function cargarTablaRutasCapturaAudio(){
     var fechaInicio = $('#formRangoFecha1Audio').data('DateTimePicker').
												  date.format();
     var fechaFin = $('#formRangoFecha2Audio').data('DateTimePicker').
											   date.format();
     /*
		var fechaInicio = "2016-07-26T12:55";
		var fechaFin = "2016-07-25T12:55";
   	  */
	 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                             'token'   : config.getToken(),
                                             'tenant'  : config.getTennant(),
                                             
     },
                         'data'         : { 
                        	 'fechaInicio': fechaInicio,
                        	 'fechaFin': fechaFin,
                        	 'id': "{{idVehiculo}}"
                         }
     };
	 
     var request = $.ajax({
         type: "POST",
         url		: "{% url 'wsvehiculoRangoFechaCapturaAudio' %}",
         data	: {
             request: JSON.stringify(peticion)
         },
         dataType: "json"
     });
     request.done(function(respuesta){
         if(respuesta.success){
             pintarTablaRutasCapturaAudio(respuesta["data"]);
         }else{ }
     });
     request.fail(function(jqXHR, textStatus){ });
 };

 //------------------Inicio carga el listado de alarmas por vehiculo-----------------------
 function cargarTablaAlarmasPorVehiculo(){
     var fechaInicio = $('#formRangoFecha1Alarma').data('DateTimePicker').date.format();
     var fechaFin = $('#formRangoFecha2Alarma').data('DateTimePicker').date.format();
     
     var peticion    = {
		 'autenticacion': {
			 'usuario' : config.getUsuarioLogin(),
             'token'   : config.getToken(),
             'tenant'  : config.getTennant(),
             
         },
         'data'         : {
             'fechaInicio': fechaInicio,
             'fechaFin': fechaFin,
             'id': "{{idVehiculo}}"
         }
     };
	 
     var request = $.ajax({
         type : "POST",
         url  : "{% url 'wslistarAlarmasPorVehiculo' %}",
         data : {
             request: JSON.stringify(peticion)
         },
         dataType: "json"
     });
     
     request.done(function(respuesta){
         if(respuesta.success){
             pintarTablaAlarmasPorVehiculo(respuesta["data"]);
         }else{ }
     });
     request.fail(function(jqXHR, textStatus){ });
 };


 function pintarTablaAlarmasPorVehiculo(data){
     var dataSet = data;

     if ( ! $.fn.DataTable.isDataTable( '#graficoTabla4' ) ) {
		 $('#graficoTabla4').DataTable({
			 responsive: true,
			 data: dataSet,
			 fixedHeader:true,
			 
			 "pageLength"	:100,
			 "aaSorting": [],
			 language: traduccionDatatables,
			 columns: [


				 {  title: "Hora registrada",
					data : null
				 },

				 {  title: "Tipo",
					data : null
				 },	        
				 {  title: "Latitud",
					data : null
				 },
				 {  title: "Longitud",
					data : null
				 },
				 {  title: "Ver posición",
					data : null
				 },
				 {  title: "Detalle",
					data : null
				 },
				 
			 ],
			 "columnDefs": [	        	
							
	      					{
	      						"targets": [0],
								"render": function (data, type, full, meta){
									if( data.horaRegistrada != "" ){
										horaRegistrada = moment(data.horaRegistrada).format("YYYY-MM-DD h:mm a");
		    						}					
									return horaRegistrada;
								}
							},
							{
	      						"targets": [1],
								"render": function (data, type, full, meta){
									var tipoAlarma = data.tipoAlarma;
									if(tipoAlarma ==  "alarmasBotonPanico"){
										return "Botón pánico";	
									}else{
										return "Zona alarma";	
									}
									
								}
							},

							{
	      						"targets": [2],
								"render": function (data, type, full, meta){
									var latitud = "";
									if( data.latitud != "" ){
										latitud = data.latitud;
		    						}
									return latitud;
								}
							},

							{
	      						"targets": [3],
								"render": function (data, type, full, meta){
									var longitud = "";
									if( data.longitud != "" ){
										longitud = data.longitud;
		    						}
									return longitud;
								}
							},

							{
	      						"targets": [4],
								"render": function (data, type, full, meta){
									return '<a href="#verPosicion" class="verPosicion" ><img src="{% static "images/pinUbicacion.png" %} " class="imagenPin" >Ver Posición</a>'+'<input class="verPosicionData" type="hidden" value="'+JSON.stringify(data).replace(/"/g, '&quot;')+'" />';
								}
							},			

							{
								"targets": [5],
								"render": function (data, type, full, meta){
									var tipoAlarma = data.tipoAlarma;
									if(tipoAlarma ==  "alarmasBotonPanico"){
										return '<a href="'+guibase+'/{{tenant}}/adminDetalleAlarmaPanico/'+data.idAlarma+'" >Ver detalle</a>';	
									}else{
										return '<a href="'+guibase+'/{{tenant}}/adminDetalleZonaAlarma/'+data.idAlarma+'" >Ver detalle</a>';	
									}	            	
									
								}
      						},

			 ]
		 });
     }   
     else{
		 $('#graficoTabla4').DataTable().clear().rows.add(dataSet).draw();
		 
     }
 }
 //-----Fin carga el listado de alarmas por vehiculo--------------------
 //========================= Fin audio vehículo ==================================

 //------ Cargar picker de conductores----------------------------------------------------
 function traerConductores(){
     var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                             'token'   : config.getToken(),
                                             'tenant'  : "{{tenant}}",          
     },
                         'data'          : {      }
     };
	 
     var request = $.ajax({
		 type        : "POST",
		 url         : "{% url 'wsPickerConductores' %}",
		 data        : {
             request :  JSON.stringify(peticion)
         },
		 dataType    : "json"

     }).done(function(respuesta){
         if (respuesta.success){

             cargarPickerConductores(respuesta.data);
         }
         else{
             notif({
                 msg     : respuesta.mensaje,
                 type    : "error",
                 position: "center"
             });
         }
     }).fail(function(jqXHR, textStatus){
         notif({
             msg     : "Falló la conexión",
             type    : "error",
             position: "center"
         });
     }).always(function(){
         
     });
 }

 var conductores = new Array();
 function cargarPickerConductores(data){
	 if(data.length != 0){
	     for(i = 0; i < data.length; i++){
	    	 conductores[i] = data[i];
	     }
	     
	     var totalDatos	= conductores.length;
	     for (i = 0; i < totalDatos; i++){
			 var itemConductor = conductores[i];
			 var cedulaConductor = itemConductor.cedula
			 var nombresConductor = itemConductor.nombres;
			 var apellidosConductor = itemConductor.apellidos;
			 $('#grupoConductor').append('<option value="'+i+'">'+cedulaConductor+'-'+nombresConductor+' '+apellidosConductor+'</option>');
	     }

	     totalDatos	= conductores.length;
		 
    	 $('#grupoConductor').append('<option value="'+totalDatos+'"> Sin conductor </option>');
	     
	     $('#grupoConductor').selectpicker('refresh');
		 $('#grupoConductor').selectpicker('deselectAll');
	 	 $('#grupoConductor').selectpicker('refresh');
	 	 
 	 }
 }

 function asignarConductorVehiculo(idConductor){
	 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                             'token'   : config.getToken(),
                                             'tenant'  : config.getTennant(),
     },
                         'data'         : {  
                        	 'idVehiculo' : "{{idVehiculo}}",
                        	 'idConductor': idConductor
                         }
     };
	 
     var request = $.ajax({
         type: "POST",
         url		: "{% url 'wsAsignarConductor' %}",
         data	: {
             request: JSON.stringify(peticion)
         },
         dataType: "json"
     });
     request.done(function(respuesta){
         if(respuesta.success){
        	 $('#formularioAceptarAsignar').modal('hide');
             notif({
                 msg     : "El conductor fue asignado",
                 type    : "success",
                 position: "center"
             });    
         }else{
        	 notif({
                 msg     : "Error",
                 type    : "error",
                 position: "center"
             });
         }
     });
     request.fail(function(jqXHR, textStatus){ });
 }



 function reAsignarConductorVehiculo(idConductor){
	 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                             'token'   : config.getToken(),
                                             'tenant'  : config.getTennant(),
     },
                         'data'         : {  
                        	 'idVehiculo' : "{{idVehiculo}}",
                        	 'idConductor': idConductor
                         }
     };
	 
     var request = $.ajax({
         type: "POST",
         url		: "{% url 'wsReAsignarConductor' %}",
         data	: {
             request: JSON.stringify(peticion)
         },
         dataType: "json"
     });
     request.done(function(respuesta){
         if(respuesta.success){
        	 $('#formularioAceptarAsignarForzado').modal('hide');
             notif({
                 msg     : "El conductor fue asignado",
                 type    : "success",
                 position: "center"
             });    
         }else{
        	 notif({
                 msg     : "Error",
                 type    : "error",
                 position: "center"
             });
         }
     });
     request.fail(function(jqXHR, textStatus){ });
 }

 function verificarConductorAsignado(idConductor){
	 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                             'token'   : config.getToken(),
                                             'tenant'  : config.getTennant(),
     },
                         'data'         : {  
                        	 'idConductor': idConductor
                         }
     };
	 
     var request = $.ajax({
         type: "POST",
         url		: "{% url 'wsVerificarConductorAsignado' %}",
         data	: {
             request: JSON.stringify(peticion)
         },
         dataType: "json"
     });
     request.done(function(respuesta){
    	 $('#formularioAceptarAsignar').modal('hide');
         if(respuesta.success){
        	 if(respuesta.existe){
        		 $('#formularioAceptarAsignarForzado').modal('show');

        	 }else{
        		 //asigna el conductor al vehiculo
        		 asignarConductorVehiculo(idConductor);
        	 }

         }else{
        	 notif({
                 msg     : "Error",
                 type    : "error",
                 position: "center"
             });

         }
     });
     request.fail(function(jqXHR, textStatus){ });
 }


 //------ Cargar picker de estado de carga----------------------------------------------------

<<<<<<< HEAD
 var estadoCarga = ["Con carga", "Sin carga"];
 function cargarPickerEstadoCarga(data){
	 var totalDatos	= estadoCarga.length;
	 for (i = 0; i < totalDatos; i++){
		 var itemCarga = estadoCarga[i];
		 $('#grupoCarga').append('<option value="'+i+'">'+itemCarga+'</option>');
	 }
	 
	 $('#grupoCarga').selectpicker('refresh');
	 $('#grupoCarga').selectpicker('deselectAll');
	 $('#grupoCarga').selectpicker('refresh');
	 
 }

 function actualizarEstadoCarga(estaCargado){
	 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
                                             'token'   : config.getToken(),
                                             'tenant'  : config.getTennant(),
     },
                         'data'         : {  
                        	 'idVehiculo' : "{{idVehiculo}}",
                        	 'cargado': estaCargado
                         }
     };
	 
     var request = $.ajax({
         type: "POST",
         url		: "{% url 'wsActualizarEstadoCarga' %}",
         data	: {
             request: JSON.stringify(peticion)
         },
         dataType: "json"
     });
     request.done(function(respuesta){
         if(respuesta.success){
             notif({
                 msg     : "El estado de carga fue actualizado",
                 type    : "success",
                 position: "center"
             });    
         }else{
        	 notif({
                 msg     : "Error al actualizar",
                 type    : "error",
                 position: "center"
             });
         }
     });
     request.fail(function(jqXHR, textStatus){ });
 }

 function cargarSlider(){
	 var slider         = document.getElementById('slider');	 
	 noUiSlider.create(slider, {
		 start: 100000,
		 connect: "lower",
		 step:	1,
		 range: {
			 min: 0,
			 max: 100000
		 }
	 });
	 
	 $('#fechaSlider').text("...");	   
	 slider.noUiSlider.on('update', function(){
		 actualizarSliderFecha(false);
	 });
	 slider.noUiSlider.on('set', function(){
		 actualizarSliderFecha(true);
	 });

 }

 //Resetea en la posición inicial de slider fecha con la fecha adecuada.
 function actualizarSliderFecha(debeCargarDireccion){
	 var slider     = document.getElementById('slider');
	 var valor      = slider.noUiSlider.get();
	 var porcentaje = valor / 100000*1.0;
	 if(dataRuta != null){
		 if(dataRuta.length > 0){
			 var posicion = parseInt( (dataRuta.length-1) * porcentaje);
			 if(posicion < 0 ){
				 posicion = 0;
			 }
			 var posicionRuta   = dataRuta[posicion];
			 var horaRegistrada = posicionRuta.horaRegistrada;
			 //var fecha          = moment(horaRegistrada).format("DD/MM/YYYY hh:mm a");
			 var fecha = moment(horaRegistrada).format("dddd DD [de] MMMM YYYY [a las] hh:mm a");
			 var velocidad      = parseFloat(posicionRuta.velocidad.toFixed(1));
			 $('#fechaSlider').text(fecha);	   
			 
			 if(debeCargarDireccion){

				 if(markerPosicionVehiculoRuta != null){
					 markerPosicionVehiculoRuta.setMap(null);
					 markerPosicionVehiculoRuta = null;
				 }
				 markerPosicionVehiculoRuta = new google.maps.Marker({
					 //position: data_destino,
					 //map     : map,
					 icon    : guiImagePuntoControl+"/static/images/pinUbicacion.png",
					 title   : "..."
				 });

				 google.maps.event.addListener(markerPosicionVehiculoRuta, 'click', function() {
					 if(infoWindowPosicionVehiculoRuta != null){
						 infoWindowPosicionVehiculoRuta.open(map1, this);
					 }
				 });
				 
				 //if(markerPosicionVehiculoRuta != null){
				 var posicionMarker = { lat: posicionRuta.latitud, lng: posicionRuta.longitud};				   
				 markerPosicionVehiculoRuta.setPosition(posicionMarker);

				 markerPosicionVehiculoRuta.setMap(map1);				   
				 
				 if(infoWindowPosicionVehiculoRuta == null){
					 infoWindowPosicionVehiculoRuta = new google.maps.InfoWindow({
						 content: ''
					 });
				 }else{
					 infoWindowPosicionVehiculoRuta.close();
				 }
				 
				 
				 if(geocoder == null){
					 geocoder = new google.maps.Geocoder;
				 }

				 geocoder.geocode(
					 {'location': posicionMarker},
					 function(results, status) {
						 var direccion = "";						   						   
						 if (status === 'OK') {
							 if (results[0]) {								   
								 direccion = results[0].formatted_address;													   
							 } else {
								 direccion = "Dirección no definida";
							 }
						 } else {
							 direccion = "Servicio de dirección no disponible";
						 }

						 var htmlInfoWindow = Mustache.render(templateInfoWindowPosicion,{
							 "direccion" : direccion,
							 "fechaHora" : fecha,
							 "velocidad" : velocidad
						 });
						 
						 infoWindowPosicionVehiculoRuta.setContent(htmlInfoWindow);
						 infoWindowPosicionVehiculoRuta.open(map1, markerPosicionVehiculoRuta);
					 }
				 );
				 
				 

				 
				 //}
				 
			 }
			 
			 
		 }
	 }
 }

 function reiniciarSlider(){
	 var slider  = document.getElementById('slider');
	 slider.noUiSlider.set(100000);
	 //actualizarSliderFecha(true)
 }


 //==============================================================================
 // === Document ready!!! =======================================================
 $(document).ready(function() {

	 cargarSlider();
	 cargarPickerEstadoCarga();

	 //======= Inicio Picker conductores =======	
	 traerConductores();
	 $("#grupoConductor").change(function() {
		 //click picker
		 $('#formularioAceptarAsignar').modal('show');
	 });	

	 $(document).on('click', '#aceptarAsignarConductor', function(){
		 var posicion = $('#grupoConductor')	.val();
         if(!(posicion == conductores.length)){
 			 var datoConductor = conductores[posicion];
 			 idConductor		  = datoConductor.id;
 			 verificarConductorAsignado(idConductor);
 		 }else{
 			 idConductor = "";
 			 asignarConductorVehiculo(idConductor)

 		 }	
	 });	
	 
	 $(document).on('click', '#aceptarAsignarConductorForzado', function(){
		 var posicion = $('#grupoConductor')	.val();
         if(!(posicion == conductores.length)){
 			 var datoConductor = conductores[posicion];
 			 idConductor		= datoConductor.id;
			 reAsignarConductorVehiculo(idConductor);
 		 }else{
 			 idConductor = "";
 			 asignarConductorVehiculo(idConductor)
 		 }		
	 });   

	 //======= Fin Picker conductores ==========

	 //======= Inicio Picker estado carga =======	
	 
	 $("#grupoCarga").change(function() {
		 //click picker
		 var estaCargado = false;
		 var posicion = $('#grupoCarga')	.val();
		 if(posicion == 0){
			 estaCargado = true;
		 }
		 actualizarEstadoCarga(estaCargado);
	 });	

	 //======= Fin Picker carga =======	

	 buscarLlamadaActivaDirecta();

	 $("#tabAudios").click(function() {
		 // cuando se da click a la pestaña audios
		 $("#sidLlamada").val("");
		 if($("#sidLlamada").val()==""){
			 pintarBotonAudioPlay();	
		 }else{
			 pintarBotonAudioStop();
		 } 	
	 });

	 $("#tabAudios").click(function() {
		 // cuando se da click a la pestaña audios
		 buscarLlamadaActivaDirecta();
		 
	 });


	 var fechaAhora = moment();
	 var fechaAyer = moment().subtract(1, 'days');

	 $('.formRangoFecha').datetimepicker(

	     { 	pickTime: true,

	       showToday: true,
	       pick12HourFormat: true,
	       minViewMode: "years",
		   minViewMode: "months",
		   minViewMode: "days",
		   language:'es' });

	 $('#formRangoFecha1').data('DateTimePicker').setDate(fechaAyer);
	 $('#formRangoFecha2').data('DateTimePicker').setDate(fechaAhora);
	 
	 traerDatosVehiculo();
	 cargarTablaRutas();
	 cargarTablaParadas();
	 cargarTablaRutasCapturaImagen();
	 cargarTablaRutasCapturaAudio();
	 cargarTablaAlarmasPorVehiculo();
	 //==========================Inicio Ready Detalle vehiculo=================================
	 //submit posiciones
	 $('#formularioDetalle').validator().on('submit', function (e) {
		 if (e.isDefaultPrevented()) {
			 notif({
	             msg     : "Invalido campo",
	             type    : "error",
	             position: "center"
	         });
		 } else {
		  	 //aqui se valida que la primer fecha no sea superior a la segunda
		  	 var permiteAccion =validarFechasUsuario('#formRangoFecha1', '#formRangoFecha2');
		  	 if(permiteAccion){
			  	 map1	= null;
				 //Limpia el div del map1
				 $(".map1").html("");	
			     cargarTablaRutas();
			     cargarTablaParadas();
			     //cargarDatosMapa();
			 }
		     e.preventDefault();
		 }
	 });	
	 //==========================Fin Ready Detalle vehiculo=================================
	 //========================= Inicio Ready Imagenes vehiculo =======
	 $('#formRangoFecha1Imagenes').data('DateTimePicker').setDate(fechaAyer);
	 $('#formRangoFecha2Imagenes').data('DateTimePicker').setDate(fechaAhora);

	 $('#formularioImagenes').validator().on('submit', function (e) {
		 if (e.isDefaultPrevented()) {
			 notif({
	             msg     : "Invalido campo",
	             type    : "error",
	             position: "center"
	         });
		 } else {
			 //aqui se valida que la primer fecha no sea superior a la segunda
			 var permiteAccion =validarFechasUsuario('#formRangoFecha1Imagenes', '#formRangoFecha2Imagenes');
			 if(permiteAccion){
				 cargarTablaRutasCapturaImagen();

			 }		    
		     e.preventDefault();
		 }
	 });


	 function capturarImagenDirectaGPS(){
		 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
	                                             'token'   : config.getToken(),
	                                             'tenant'  : config.getTennant(),
	                                             
	     },
	                         'data'         : { 
	                        	 'idVehiculo': "{{idVehiculo}}",
	                         }
	     };
		 
	     var request = $.ajax({
	         type: "POST",
	         url		: "{% url 'wssolicitarCapturaImagen' %}",
	         data	: {
	             request: JSON.stringify(peticion)
	         },
	         dataType: "json"
	     });
	     request.done(function(respuesta){
	         if(respuesta.success){
	        	 data = respuesta.data;
	             //alert(data.id);
	             //console.log(data.id);
				 $('#mensajeNotificacion').text("Se solicito la captura de la imagen");
				 $('#formularioAceptarNotificacion').modal('show');
	         }else{ }
	     });
	     request.fail(function(jqXHR, textStatus){ });
	 };


	 $(document).on('click', '#capturarImagen', function(){ 
		 //Peticion del boton para capturar la imagen del GPS
		 capturarImagenDirectaGPS();

	 });


	 //================ Fin Ready Imagenes vehiculo =======

	 //========================= Inicio Audio vehiculo =================================
	 $('#formRangoFecha1Audio').data('DateTimePicker').setDate(fechaAyer);
	 $('#formRangoFecha2Audio').data('DateTimePicker').setDate(fechaAhora);

	 $('#formularioAudios').validator().on('submit', function (e) {
		 if (e.isDefaultPrevented()) {
			 notif({
	             msg     : "Invalido campo",
	             type    : "error",
	             position: "center"
	         });
		 } else {
			 var permiteAccion =validarFechasUsuario('#formRangoFecha1Audio', '#formRangoFecha2Audio');
			 if(permiteAccion){
				 cargarTablaRutasCapturaAudio();

			 }		  	
		     e.preventDefault();
		 }
	 });

	 var sid; //variable temporal para prueba
	 function capturarAudioGPS(){
		 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
	                                             'token'   : config.getToken(),
	                                             'tenant'  : config.getTennant(),
	                                             
	     },
	                         'data'         : { 
	                        	 'idVehiculo': "{{idVehiculo}}",
	                         }
	     };
		 
	     var request = $.ajax({
	         type: "POST",
	         url		: "{% url 'wssolicitarCapturaAudio' %}",
	         data	: {
	             request: JSON.stringify(peticion)
	         },
	         dataType: "json"
	     });
	     request.done(function(respuesta){
	         if(respuesta.success){
	        	 sid = respuesta["sid"];
	        	 pintarBotonAudioStop();
	             $("#sidLlamada").val(sid);
	         }else{ 
	        	 mensaje = respuesta["mensaje"];
				 $('#mensajeNotificacion').text(mensaje);
				 $('#formularioAceptarNotificacion').modal('show');
	         }
	     });
	     request.fail(function(jqXHR, textStatus){ });
	 };

	 function buscarLlamadaActivaDirecta(){
		 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
	                                             'token'   : config.getToken(),
	                                             'tenant'  : config.getTennant(),
	                                             
	     },
	                         'data'         : { 
	                        	 'idVehiculo': "{{idVehiculo}}",
	                         }
	     };
		 
	     var request = $.ajax({
	         type: "POST",
	         url		: "{% url 'wsbuscarLlamadaActivaDirecta' %}",
	         data	: {
	             request: JSON.stringify(peticion)
	         },
	         dataType: "json"
	     });
	     request.done(function(respuesta){
	         if(respuesta.success){
	        	 $("#sidLlamada").val(respuesta.sidLlamada);
	        	 pintarBotonAudioStop();	
	         }
	         else{
				 respuesta = respuesta["respuesta"];
				 $("#sidLlamada").val("");
				 pintarBotonAudioPlay();	        	

	         }


	     });
	     request.fail(function(jqXHR, textStatus){ });
	 };



	 function detenerAudioGPS(sid){
		 var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
	                                             'token'   : config.getToken(),
	                                             'tenant'  : config.getTennant(),
	                                             
	     },
	                         'data'         : { 
	                        	 'idVehiculo': "{{idVehiculo}}",
	                        	 'sid': sid,
	                         }
	     };
		 
	     var request = $.ajax({
	         type: "POST",
	         url		: "{% url 'wsdetenerCapturaAudio' %}",
	         data	: {
	             request: JSON.stringify(peticion)
	         },
	         dataType: "json"
	     });
	     request.done(function(respuesta){
	         if(respuesta.success){
	        	 respuesta = respuesta["respuesta"];
				 pintarBotonAudioPlay();
				 $("#sidLlamada").val("");
	         }
	         else{
	        	 respuesta = respuesta["respuesta"];
	        	 pintarBotonAudioStop();
	        	 $("#sidLlamada").val(sid);
	         }

	       	 $('#mensajeNotificacion').text(respuesta);
			 $('#formularioAceptarNotificacion').modal('show');

	     });
	     request.fail(function(jqXHR, textStatus){ });
	 };


	 function pintarBotonAudioPlay(){
		 $("#capturarAudio i").removeClass("fa-stop");
		 $("#capturarAudio i").removeClass("fa-microphone");
		 $("#capturarAudio i").addClass("fa-2x");
		 $("#capturarAudio span").text("Tomar una nueva captura");
		 $("#capturarAudio i").addClass("fa-microphone");
		 
	 }

	 $(document).on('click', '#capturarAudio', function(){ 
		 //alert($("#sidLlamada").val())
		 //Peticion del boton para capturar el audio del GPS 
		 if($("#sidLlamada").val()==""){
			 //alert("hola"+$("#sidLlamada").val());
			 capturarAudioGPS();
			 //$("#sidLlamada").val("nuevo");
			 pintarBotonAudioStop();	
		 }else{
			 //sid = $("#sidLlamada").val("");
			 detenerAudioGPS(sid);
			 //alert("hola2"+sid);
			 pintarBotonAudioPlay();
			 $("#sidLlamada").val("");
			 /*
				if($("#sidLlamada").val("") !=""){
=======
	$('#formRangoFecha1').data('DateTimePicker').setDate(fechaAyer);
	$('#formRangoFecha2').data('DateTimePicker').setDate(fechaAhora);
	
	traerDatosVehiculo();
	cargarTablaRutas();
	cargarTablaParadas();
	cargarTablaRutasCapturaImagen();
	cargarTablaRutasCapturaAudio();
	cargarTablaAlarmasPorVehiculo();
	
	
	//==========================Inicio Ready Detalle vehiculo=================================
	//submit posiciones
	$('#formularioDetalle').validator().on('submit', function (e) {
		  if (e.isDefaultPrevented()) {
			notif({
	                msg     : "Invalido campo",
	                type    : "error",
	                position: "center"
	            });
		  } else {
		  	//aqui se valida que la primer fecha no sea superior a la segunda
		  	var permiteAccion =validarFechasUsuario('#formRangoFecha1', '#formRangoFecha2');
		  	if(permiteAccion){
			  	map1	= null;
				//Limpia el div del map1
				$(".map1").html("");	
			    cargarTablaRutas();
			    cargarTablaParadas();
			    //cargarDatosMapa();
			}
		    e.preventDefault();
		  }
		});	
	//==========================Fin Ready Detalle vehiculo=================================
	//========================= Inicio Ready Imagenes vehiculo =======
	$('#formRangoFecha1Imagenes').data('DateTimePicker').setDate(fechaAyer);
	$('#formRangoFecha2Imagenes').data('DateTimePicker').setDate(fechaAhora);

	$('#formularioImagenes').validator().on('submit', function (e) {
		  if (e.isDefaultPrevented()) {
			notif({
	                msg     : "Invalido campo",
	                type    : "error",
	                position: "center"
	            });
		  } else {
			//aqui se valida que la primer fecha no sea superior a la segunda
			var permiteAccion =validarFechasUsuario('#formRangoFecha1Imagenes', '#formRangoFecha2Imagenes');
			if(permiteAccion){
				cargarTablaRutasCapturaImagen();

			}		    
		    e.preventDefault();
		  }
	});


	function capturarImagenDirectaGPS(){
		var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
	                                            'token'   : config.getToken(),
	                                            'tenant'  : config.getTennant(),
	                                                
	                                            },
	                        'data'         : { 
	                        					'idVehiculo': "{{idVehiculo}}",
	                        				 }
	                      };
		
	    var request = $.ajax({
	            type: "POST",
	            url		: "{% url 'wssolicitarCapturaImagen' %}",
	            data	: {
	                        request: JSON.stringify(peticion)
	             },
	             dataType: "json"
	        });
	    request.done(function(respuesta){
	        if(respuesta.success){
	        	data = respuesta.data;
	            //alert(data.id);
	            //console.log(data.id);
				$('#mensajeNotificacion').text("Se solicito la captura de la imagen");
				$('#formularioAceptarNotificacion').modal('show');
	        }else{ }
	    });
	    request.fail(function(jqXHR, textStatus){ });
	};


	$(document).on('click', '#capturarImagen', function(){ 
		//Peticion del boton para capturar la imagen del GPS
		capturarImagenDirectaGPS();

	});


	//================ Fin Ready Imagenes vehiculo =======

	//========================= Inicio Audio vehiculo =================================
	$('#formRangoFecha1Audio').data('DateTimePicker').setDate(fechaAyer);
	$('#formRangoFecha2Audio').data('DateTimePicker').setDate(fechaAhora);

	$('#formularioAudios').validator().on('submit', function (e) {
		  if (e.isDefaultPrevented()) {
			notif({
	                msg     : "Invalido campo",
	                type    : "error",
	                position: "center"
	            });
		  } else {
			var permiteAccion =validarFechasUsuario('#formRangoFecha1Audio', '#formRangoFecha2Audio');
			if(permiteAccion){
				cargarTablaRutasCapturaAudio();

			}		  	
		    e.preventDefault();
		  }
		});

	var sid; //variable temporal para prueba
	function capturarAudioGPS(){
		var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
	                                            'token'   : config.getToken(),
	                                            'tenant'  : config.getTennant(),
	                                                
	                                            },
	                        'data'         : { 
	                        					'idVehiculo': "{{idVehiculo}}",
	                        				 }
	                      };
		
	    var request = $.ajax({
	            type: "POST",
	            url		: "{% url 'wssolicitarCapturaAudio' %}",
	            data	: {
	                        request: JSON.stringify(peticion)
	             },
	             dataType: "json"
	        });
	    request.done(function(respuesta){
	        if(respuesta.success){
	        	sid = respuesta["sid"];
	        	pintarBotonAudioStop();
	            $("#sidLlamada").val(sid);
	        }else{ 
	        	mensaje = respuesta["mensaje"];
				$('#mensajeNotificacion').text(mensaje);
				$('#formularioAceptarNotificacion').modal('show');
	        }
	    });
	    request.fail(function(jqXHR, textStatus){ });
	};

	function buscarLlamadaActivaDirecta(){
		var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
	                                            'token'   : config.getToken(),
	                                            'tenant'  : config.getTennant(),
	                                                
	                                            },
	                        'data'         : { 
	                        					'idVehiculo': "{{idVehiculo}}",
	                        				 }
	                      };
		
	    var request = $.ajax({
	            type: "POST",
	            url		: "{% url 'wsbuscarLlamadaActivaDirecta' %}",
	            data	: {
	                        request: JSON.stringify(peticion)
	             },
	             dataType: "json"
	        });
	    request.done(function(respuesta){
	        if(respuesta.success){
	        	$("#sidLlamada").val(respuesta.sidLlamada);
	        	pintarBotonAudioStop();	
	        }
	        else{
				respuesta = respuesta["respuesta"];
				$("#sidLlamada").val("");
				pintarBotonAudioPlay();	        	

	        }


	    });
	    request.fail(function(jqXHR, textStatus){ });
	};



	function detenerAudioGPS(sid){
		var peticion    = { 'autenticacion': {  'usuario' : config.getUsuarioLogin(),
	                                            'token'   : config.getToken(),
	                                            'tenant'  : config.getTennant(),
	                                                
	                                            },
	                        'data'         : { 
	                        					'idVehiculo': "{{idVehiculo}}",
	                        					'sid': sid,
	                        				 }
	                      };
		
	    var request = $.ajax({
	            type: "POST",
	            url		: "{% url 'wsdetenerCapturaAudio' %}",
	            data	: {
	                        request: JSON.stringify(peticion)
	             },
	             dataType: "json"
	        });
	    request.done(function(respuesta){
	        if(respuesta.success){
	        	respuesta = respuesta["respuesta"];
				pintarBotonAudioPlay();
				$("#sidLlamada").val("");
	        }
	        else{
	        	respuesta = respuesta["respuesta"];
	        	pintarBotonAudioStop();
	        	$("#sidLlamada").val(sid);
	        }

	       	$('#mensajeNotificacion').text(respuesta);
			$('#formularioAceptarNotificacion').modal('show');

	    });
	    request.fail(function(jqXHR, textStatus){ });
	};


	function pintarBotonAudioPlay(){
		$("#capturarAudio i").removeClass("fa-stop");
		$("#capturarAudio i").removeClass("fa-microphone");
		$("#capturarAudio i").addClass("fa-2x");
		$("#capturarAudio span").text("Tomar una nueva captura");
		$("#capturarAudio i").addClass("fa-microphone");
		
	}

	$(document).on('click', '#capturarAudio', function(){ 
		//alert($("#sidLlamada").val())
		//Peticion del boton para capturar el audio del GPS 
		if($("#sidLlamada").val()==""){
			//alert("hola"+$("#sidLlamada").val());
			capturarAudioGPS();
			//$("#sidLlamada").val("nuevo");
			pintarBotonAudioStop();	
		}else{
			//sid = $("#sidLlamada").val("");
			detenerAudioGPS(sid);
			//alert("hola2"+sid);
			pintarBotonAudioPlay();
			$("#sidLlamada").val("");
			/*
			if($("#sidLlamada").val("") !=""){
>>>>>>> origin/masterpuntosdeparada
				$("#sidLlamada").val(sid);
				$("#sidLlamada").val("");
				}
				else{
			 	$("#sidLlamada").val("");
<<<<<<< HEAD
				}*/
		 }
		 

	 });

	 //========================= Fin Ready Audio vehiculo =================================

	 //========================= Inicio Ready alarmas vehiculo=============================
	 $('#formRangoFecha1Alarma').data('DateTimePicker').setDate(fechaAyer);
	 $('#formRangoFecha2Alarma').data('DateTimePicker').setDate(fechaAhora);

	 $('#formularioAlarmas').validator().on('submit', function (e) {
		 if (e.isDefaultPrevented()) {
			 notif({
	             msg     : "Invalido campo",
	             type    : "error",
	             position: "center"
	         });
		 } else {
			 var permiteAccion =validarFechasUsuario('#formRangoFecha1Alarma', '#formRangoFecha2Alarma');
			 if(permiteAccion){
				 cargarTablaAlarmasPorVehiculo();

			 }		  	
		     e.preventDefault();
		 }
	 });

	 //========================= Fin Ready alarmas Vehiculo================================

	 //================Inicio Boton actualizar===============
	 $( "#actualizarPestanas" ).click(function() {

		 var pestanas = $("#pestanaSuperiores li.active");
		 var idPestana = $("#pestanaSuperiores li.active").attr('id');

		 if (idPestana == "tabDetalle"){
			 //aqui se valida que la primer fecha no sea superior a la segunda
			 var fechaAhora = moment();
			 $('#formRangoFecha2').data('DateTimePicker').setDate(fechaAhora);
			 var permiteAccion = validarFechasUsuario('#formRangoFecha1', '#formRangoFecha2');
			 if(permiteAccion){
				 zoomGlobal = map1.getZoom();
    			 posicionCamaraGlobal = map1.getCenter();
    			 usarZoom = true;

				 map1	= null;
				 //Limpia el div del map1
				 $(".map1").html("");
				 //cargarDatosMapa();
				 traerDatosVehiculo();
				 cargarTablaRutas();
				 cargarTablaParadas();
			 }

		 }

		 if (idPestana == "tabImagenes"){
			 //aqui se valida que la primer fecha no sea superior a la segunda
			 var fechaAhora = moment();
			 $('#formRangoFecha2Imagenes').data('DateTimePicker').setDate(fechaAhora);		
			 var permiteAccion = validarFechasUsuario('#formRangoFecha1Imagenes', '#formRangoFecha2Imagenes');
			 if(permiteAccion){
				 cargarTablaRutasCapturaImagen();	
			 }
			 
		 }

		 if(idPestana == "tabAudios"){
			 //aqui se valida que la primer fecha no sea superior a la segunda
			 var fechaAhora = moment();
			 $('#formRangoFecha2Audio').data('DateTimePicker').setDate(fechaAhora);		
			 var permiteAccion = validarFechasUsuario('#formRangoFecha1Audio', '#formRangoFecha2Audio');
			 if(permiteAccion){
				 cargarTablaRutasCapturaAudio();	
			 }		
			 
		 }

		 if(idPestana == "tabAlarmas"){
			 var fechaAhora = moment();
			 $('#formRangoFecha2Alarma').data('DateTimePicker').setDate(fechaAhora);		
			 var permiteAccion = validarFechasUsuario('#formRangoFecha1Alarma', '#formRangoFecha2Alarma');
			 if(permiteAccion){
				 cargarTablaAlarmasPorVehiculo();	
			 }			
		 }

	 });
	 //================Fin Boton actualizar===============	

	 function pintarBotonAudioStop(){
		 $("#capturarAudio i").removeClass("fa-microphone");
		 $("#capturarAudio i").removeClass("fa-stop");
		 $("#capturarAudio i").removeClass("fa-2x");
		 $("#capturarAudio span").text("Grabando");
		 $("#capturarAudio i").addClass("fa-stop");
		 
	 }	
	 // --- End document ready ------------------------------------------------------
 });
=======
			}*/
		}
		

	});

	//========================= Fin Ready Audio vehiculo =================================

	//========================= Inicio Ready alarmas vehiculo=============================
	$('#formRangoFecha1Alarma').data('DateTimePicker').setDate(fechaAyer);
	$('#formRangoFecha2Alarma').data('DateTimePicker').setDate(fechaAhora);

	$('#formularioAlarmas').validator().on('submit', function (e) {
		  if (e.isDefaultPrevented()) {
			notif({
	                msg     : "Invalido campo",
	                type    : "error",
	                position: "center"
	            });
		  } else {
			var permiteAccion =validarFechasUsuario('#formRangoFecha1Alarma', '#formRangoFecha2Alarma');
			if(permiteAccion){
				cargarTablaAlarmasPorVehiculo();

			}		  	
		    e.preventDefault();
		  }
		});

	//========================= Fin Ready alarmas Vehiculo================================

	//================Inicio Boton actualizar===============
	$( "#actualizarPestanas" ).click(function() {

	var pestanas = $("#pestanaSuperiores li.active");
	var idPestana = $("#pestanaSuperiores li.active").attr('id');

	if (idPestana == "tabDetalle"){
			//aqui se valida que la primer fecha no sea superior a la segunda
			var fechaAhora = moment();
			$('#formRangoFecha2').data('DateTimePicker').setDate(fechaAhora);
			var permiteAccion = validarFechasUsuario('#formRangoFecha1', '#formRangoFecha2');
			if(permiteAccion){
				zoomGlobal = map1.getZoom();
    			posicionCamaraGlobal = map1.getCenter();
    			usarZoom = true;

				map1	= null;
				//Limpia el div del map1
				$(".map1").html("");
				//cargarDatosMapa();
				traerDatosVehiculo();
				cargarTablaRutas();
				cargarTablaParadas();
			}

	}

	if (idPestana == "tabImagenes"){
		//aqui se valida que la primer fecha no sea superior a la segunda
		var fechaAhora = moment();
		$('#formRangoFecha2Imagenes').data('DateTimePicker').setDate(fechaAhora);		
		var permiteAccion = validarFechasUsuario('#formRangoFecha1Imagenes', '#formRangoFecha2Imagenes');
		if(permiteAccion){
			cargarTablaRutasCapturaImagen();	
		}
		
	}

	if(idPestana == "tabAudios"){
		//aqui se valida que la primer fecha no sea superior a la segunda
		var fechaAhora = moment();
		$('#formRangoFecha2Audio').data('DateTimePicker').setDate(fechaAhora);		
		var permiteAccion = validarFechasUsuario('#formRangoFecha1Audio', '#formRangoFecha2Audio');
		if(permiteAccion){
			cargarTablaRutasCapturaAudio();	
		}		
		
	}

	if(idPestana == "tabAlarmas"){
		var fechaAhora = moment();
		$('#formRangoFecha2Alarma').data('DateTimePicker').setDate(fechaAhora);		
		var permiteAccion = validarFechasUsuario('#formRangoFecha1Alarma', '#formRangoFecha2Alarma');
		if(permiteAccion){
			cargarTablaAlarmasPorVehiculo();	
		}			
	}

	});
	//================Fin Boton actualizar===============	

function pintarBotonAudioStop(){
	$("#capturarAudio i").removeClass("fa-microphone");
	$("#capturarAudio i").removeClass("fa-stop");
	$("#capturarAudio i").removeClass("fa-2x");
	$("#capturarAudio span").text("Grabando");
	$("#capturarAudio i").addClass("fa-stop");
}	



	//moviendo el encabezado de las tablas de las pestnañas de posicions de vehiculo y tabla paradas no se solapen

	$('a[data-toggle="tab"]').on('shown.bs.tab', function (e){
		var target = $(e.target).attr("href"); // activated tab
		if(target == "#5"){
		 	var table = $('#TablaParadas').DataTable( );
		    table.fixedHeader.disable();
		    
		    var table1 = $('#graficoTabla').DataTable( );
		    table1.fixedHeader.enable();
		 }
		
		 if(target == "#6"){
		 	
		 	var table1 = $('#graficoTabla').DataTable( );
		    table1.fixedHeader.disable();
		 	
		 	var table = $('#TablaParadas').DataTable( );
		 	table.fixedHeader.enable();
		 	
		 	
		 }
		

	});

	
// --- End document ready ------------------------------------------------------
});
>>>>>>> origin/masterpuntosdeparada

</script>
{% endblock %}

{% block contenido %}
<body>
	
	<div id="page-wrapper" style="  margin: 3em; margin-top: 0;">
	
	    <div class="row">
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	    <div class="row">
	        <div class="col-lg-12">

	            <div class="panel panel-default">

	                <!-- /.panel-heading -->
	                <div class="panel-body">

							<div class="tabbable pestana">

								<ul id="pestanaSuperiores" class="nav nav-tabs">
									<div class="row">
										<div class="col-md-10">
								    	<h3 id="vehiculoPlaca" >placa</h3>
								    	</div>
								    	<div class="col-md-2">
								    		<button id="actualizarPestanas" type="button" class="btn btn-success btn-lg">    
										    	<i class="fa fa fa-refresh" aria-hidden="true"></i>
										    					Actualizar
									    	</button>
								    	</div>
								   
						  			 </div>
						  		
								    <li id="tabDetalle" class="active"><a href="#1" data-toggle="tab">Detalle</a></li>
								    <li id="tabImagenes" {% if paquete in 'basico'|slice:',' %} style="display: none;" {% endif %} ><a href="#2" data-toggle="tab">Imágenes</a></li>
								    <li id="tabAudios" ><a href="#3" data-toggle="tab">Audios</a></li>
								    <li id="tabAlarmas" ><a href="#4" data-toggle="tab">Alarmas</a></li>
								

							  	</ul>
								<div class="tab-content">
	                                <div class="tab-pane active" id="1">
	                                	<form data-toggle="validator" role="form" id="formularioDetalle">
	                                		<!--Inicio Tab detalle-->
											<div class="row">
											  											  											  
											  <div class="col-md-2" style="display:none;"><h5 class="bold">IMEI GPS</h5>
											  		<h6 id="vehiculoImei"></h6></div>
											  <div class="col-md-2"  style="display:none;"><h5 class="bold">N. Simcard</h5> 
											  		<h6 id="vehiculoSimcard"></h6></div>
											  <div class="col-md-2"  style="display:none;"><h5 class="bold">Tipo GPS</h5>
											  		<h6 id="vehiculoTipo"></h6></div>
											</div>
											
											<div class="row">
												<div class="col-md-4">
													
													<div class="row">
														<div class="col-md-6"><h5 class="bold">Marca</h5> 
											  				<h6 id="vehiculoMarca"></h6></div>
														<div class="col-md-6"><h5 class="bold">Modelo</h5>
											  				<h6 id="vehiculoModelo"></h6></div>
													</div>
											  	<div class="form-group">
									           		<div class="row">
														<div class="col-md-5">
															 <h5 class="bold">Conductor asignado:</h5>																    															  
														  </div>
														  <div class="col-md-7">
																  		
															  	<div id="selectConductor">
															      <select class="selectpicker" data-width="100%"  data-live-search="true" title="Seleccionar Conductor" id="grupoConductor" name="grupoConductor">
															      </select>
														    	</div>

														    </div>	
														
													</div>

									           		<div class="row">
														<div class="col-md-5">
															 <h5 class="bold">Estado de carga:</h5>
																    
															  
														  </div>
														  <div class="col-md-7">
																  		
															  	<div id="selectCarga">
															      <select class="selectpicker" data-width="100%"  data-live-search="true" title="Seleccionar Estado" id="grupoCarga" name="grupoCarga">
															      </select>
														    	</div>

														    </div>	
														
													</div>
								           		</div>
											    <div class="form-group">
									           		<label>Fecha Inicio:</label>
									                <div class="input-group date formRangoFecha" id="formRangoFecha1">
									                  <input id="inputPeriodoGrafico1" type="text" required class="form-control" data-date-format="DD/MM/YYYY hh:mm a" data-error="Ingrese una fecha (DD/MM/YYYY hh:mm)"
									                  pattern="^[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]?[0-9]:[0-9][0-9]\s[(a|A|p|P)][(m|M)]$"
									                  >
									                  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span>
									                  </span>
									            	</div>
									            	<div class="help-block with-errors"></div>
										         </div>
											    <div class="form-group">
									           		<label>Fecha Fin:</label>
									                <div class="input-group date formRangoFecha" id="formRangoFecha2">
									                  <input id="inputPeriodoGrafico2" type="text" required class="form-control" data-date-format="DD/MM/YYYY hh:mm a" data-error="Ingrese una fecha (DD/MM/YYYY hh:mm)"
									                  pattern="^[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]?[0-9]:[0-9][0-9]\s[(a|A|p|P)][(m|M)]$"
									                  >
									                  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span>
									                  </span>
									            	</div>
									            	<div class="help-block with-errors"></div>
										         </div>
												<button id="recuperarRutas" type="submit" class="btn btn-raised btn-lg btn-success btn-block ">
													Recuperar
												</button>
											  </div>
											  <!-- --------------------------------------------------------------- -->

											  <!-- Parte derecha -->
											  <div class="col-md-8">
												  <div class=" text-center" style="padding-top: 1em; padding-bottom: 3em;">
													  <label id="fechaSlider" class="estiloLabelSlider"> </label>
													  <div class="slider shor" id="slider" style=""></div>
												  </div>
											  	  <div id="contenedorMapa">
					    							  <div class="map1" id="map1" style="width:100%; height:30em;"></div>    
												  </div>
											  </div>
											  <!-- --------------------------------------------------------------- -->

											  
											</div>
											<!--Tabs detalles-->
											<div class="tabbable pestana">
												<ul idid="pestanaTablas" class="nav nav-tabs" role="tablist">
													<li id="posicionesVehiculo" class="active"><a href="#5" data-toggle="tab"  role="tab">Posiciones vehículo</a></li>
													<li id="paradas"><a href="#6" data-toggle="tab" role="tab">Paradas</a></li>
												</ul>
												<div class="tab-content">
													<div class="tab-pane active" id="5" role="tabpanel" >
														<div class="row">
															<div class="col-md-12">
													
														   	 		<table id="graficoTabla" class="table table-striped table-bordered display" style="width: 100%">
										                      		</table>
														   		
															</div>
														</div>
													</div>
													<div class="tab-pane" role="tabpanel"  id="6">
														<div class="row">
															<div class="col-md-12">
														   	 		<table id="TablaParadas" class="table table-striped table-bordered display" style="width: 100%">
										                      		</table>
															</div>
														</div>
													</div>	
												</div>
											</div>
										</form>		
	                                </div>
	                                <!--Fin Tab detalle-->

	                                <!--Inicio tab imagenes-->
	                                <div class="tab-pane" id="2">
	                             		<form data-toggle="validator" role="form" id="formularioImagenes">
			                                
		                                	<div class="row">
		                                		<div class="col-md-3">
												    <div class="form-group">
										           		<label>Fecha Inicio:</label>
										                <div class="input-group date formRangoFecha" id="formRangoFecha1Imagenes">
										                  <input id="inputPeriodoGrafico3" type="text" class="form-control" 
															data-date-format="DD/MM/YYYY hh:mm a"data-date-format="DD/MM/YYYY hh:mm a" data-error="Ingrese una fecha (DD/MM/YYYY hh:mm)"
									                  		pattern="^[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]?[0-9]:[0-9][0-9]\s[(a|A|p|P)][(m|M)]$"
									                  		>
										                  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span>
										                  </span>
										            	</div>
										            	<div class="help-block with-errors"></div>
											         </div>
		                                		</div>
		                                		<div class="col-md-3">
												    <div class="form-group">
										           		<label>Fecha Fin:</label>
										                <div class="input-group date formRangoFecha" id="formRangoFecha2Imagenes">
										                  <input id="inputPeriodoGrafico4" type="text" class="form-control" 
															data-date-format="DD/MM/YYYY hh:mm a" data-error="Ingrese una fecha (DD/MM/YYYY hh:mm)"
									                  		pattern="^[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]?[0-9]:[0-9][0-9]\s[(a|A|p|P)][(m|M)]$"
									                  		>
										                  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span>
										                  </span>
										            	</div>
										            	<div class="help-block with-errors"></div>
											         </div>
		                                		</div>
		                                		<div class="col-md-2">
												    <div class="form-group"> 
												    	<label></label>                               	
														<button id="recuperarRutasImagen" type="submit" class="btn btn-raised btn-lg btn-success btn-block ">
															Filtrar
														</button>
													</div>
		                                		</div>
		                                		<div class="col-md-4">
												    <div class="form-group">
												    	<label></label>
												    	<button id="capturarImagen" type="submit" class="btn btn-success btn-lg btn-block" >    
													    	<i class="fa fa-camera fa-2x" aria-hidden="true"></i>
													    	Tomar una nueva captura
												    	</button>
													</div>
		                                		</div>
		                                	</div>
											<div class="row">
												<div class="col-md-12">
													<div class="tab-pane active" id="1" >
											   	 		<table id="graficoTabla2" class="table table-striped table-bordered display" style="width: 100%">
							                      		</table>
											   		</div>
												</div>
											</div>
	                                  	</form>
	                                </div>
	                                	<!--Fin tab imagenes-->
	                                <div class="tab-pane" id="3">
	                                <!--Inicio tab audios-->
	                                	<form data-toggle="validator" role="form" id="formularioAudios">
		                                	<div class="row">
		                                		<div class="col-md-3">
												    <div class="form-group">
										           		<label>Fecha Inicio:</label>
										                <div class="input-group date formRangoFecha" id="formRangoFecha1Audio">
										                  <input id="inputPeriodoGrafico5" type="text" class="form-control" 
										                  		data-date-format="DD/MM/YYYY hh:mm a" data-error="Ingrese una fecha (DD/MM/YYYY hh:mm)"
										                  		pattern="^[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]?[0-9]:[0-9][0-9]\s[(a|A|p|P)][(m|M)]$"
										                  		>
										                  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span>
										                  </span>
										            	</div>
										            	<div class="help-block with-errors"></div>
											        </div>
		                                		</div>
		                                		<div class="col-md-3">
												    <div class="form-group">
										           		<label>Fecha Fin:</label>
										                <div class="input-group date formRangoFecha" id="formRangoFecha2Audio">
										                  <input id="inputPeriodoGrafico6" type="text" class="form-control" 
																data-date-format="DD/MM/YYYY hh:mm a" data-error="Ingrese una fecha (DD/MM/YYYY hh:mm)"
										                  		pattern="^[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]?[0-9]:[0-9][0-9]\s[(a|A|p|P)][(m|M)]$"
										                  		>
										                  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span>
										                  </span>
										            	</div>
										            	<div class="help-block with-errors"></div>
											         </div>
		                                		</div>
		                                		<div class="col-md-2">
												    <div class="form-group">
												    	<label></label>                                	
														<button id="recuperarRutasAudio" type="submit" class="btn btn-raised btn-lg btn-success btn-block ">
															Filtrar
														</button>
													</div>
		                                		</div>
		                                		<div class="col-md-4">
												    <div class="form-group">
												    	<label></label>
												    	<button id="capturarAudio" type="submit" class="btn btn-success btn-lg btn-block capturarAudio" {% if paquete in 'basico'|slice:',' %} style="display: none;" {% endif %}>    
													    	<i class="fa fa-microphone fa-2x " aria-hidden="true"></i>
													    	<span>Tomar una nueva captura</span>
													    	 <input type="hidden" id="sidLlamada"></button>
													    </button>
													</div>
		                                		</div>
		                                	</div>
											<div class="row">
												<div class="col-md-12">
													<div class="tab-pane active" id="1" >
											   	 		<table id="graficoTabla3" class="table table-striped table-bordered display" style="width: 100%">
							                      		</table>
											   		</div>
												</div>
											</div>
	                                	</form>
	                                </div>
	  									<!--Fin tab Audios-->
	                                <div class="tab-pane" id="4">
	                                <!--Inicio tab alarmas-->
	                                	<form data-toggle="validator" role="form" id="formularioAlarmas">
		                                	<div class="row">
		                                		<div class="col-md-3">
												    <div class="form-group">
										           		<label>Fecha Inicio:</label>
										                <div class="input-group date formRangoFecha" id="formRangoFecha1Alarma">
										                  <input id="inputPeriodoGrafico7" type="text" class="form-control" 
																data-date-format="DD/MM/YYYY hh:mm a" data-error="Ingrese una fecha (DD/MM/YYYY hh:mm)"
											                  	pattern="^[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]?[0-9]:[0-9][0-9]\s[(a|A|p|P)][(m|M)]$"
											                  		>
										                  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span>
										                  </span>
										            	</div>
										            	<div class="help-block with-errors"></div>
											         </div>
		                                		</div>
		                                		<div class="col-md-3">
												    <div class="form-group">
										           		<label>Fecha Fin:</label>
										                <div class="input-group date formRangoFecha" id="formRangoFecha2Alarma">
										                  <input id="inputPeriodoGrafico8" type="text" class="form-control" 
																data-date-format="DD/MM/YYYY hh:mm a" data-error="Ingrese una fecha (DD/MM/YYYY hh:mm)"
											                  	pattern="^[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]?[0-9]:[0-9][0-9]\s[(a|A|p|P)][(m|M)]$"
											                  		>
										                  <span class="input-group-addon"><span class="glyphicon-calendar glyphicon"></span>
										                  </span>
										            	</div>
										            	<div class="help-block with-errors"></div>
											         </div>
		                                		</div>
		                                		<div class="col-md-2">
												    <div class="form-group">
												    	<label></label>                                	
														<button id="recuperarRutasAlarma" type="submit" class="btn btn-raised btn-lg btn-success btn-block ">
															Filtrar
														</button>
													</div>
		                                		</div>
		                                	</div>
											<div class="row">
												<div class="col-md-12">
													<div class="tab-pane active" id="1" >
											   	 		<table id="graficoTabla4" class="table table-striped table-bordered display" style="width: 100%">
							                      		</table>
											   		</div>
												</div>
											</div>
	                                	</form>
	                                </div>
	  									<!--Fin tab alarmas-->
	                            </div>						  

							</div>
					
					</div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-12 -->

	    </div>
	</div>
<!-- /#page-wrapper -->


<!-- /#MODAL, VENTANA EMERGENTE PARA EL MAPA-->
	<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
		<div class="modal-dialog-dp detailNoventa">
			<div class="modal-content">
				<div class="modal-header">
				
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
					<h1 class="modal-title" id="myModalLabel">Mapa</h1>
					
					<div id="contenedorMapa2" style="display:none">
							    <div id="map2" class="map2" style="width:100%; height:40em;"></div>    
					</div>
				</div>
				<div class="modal-body">

				</div>
					<div class="modal-footer">	<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>		
				</div>
			</div>
		</div>
	</div>


<!-- /#MODAL, VENTANA EMERGENTE PARA MOSTRAR NOTIFICACION-->
<div class="modal fade" id="formularioAceptarNotificacion" > 
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title">Notificación</h3>
      </div>
      <div class="modal-body">
      	<form>
      	<div class="row">
			<div class="col-md-10">
				<input type="hidden" id="formNotificacionId"/>
				<span id= "mensajeNotificacion" > </span>
			</div>
		</div>
        
		</form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-dismiss="modal">Aceptar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- /#MODAL, VENTANA EMERGENTE PARA MOSTRAR NOTIFICACION-->


<!-- /#MODAL, VENTANA EMERGENTE PARA ACEPTAR ASIGNAR CONDUCTOR-->
<div class="modal fade" id="formularioAceptarAsignar" > 
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title">Asignar conductor al vehículo</h3>
      </div>
      <div class="modal-body">
      	<form>
      	<div class="row">
			<div class="col-md-10">
				<input type="hidden" id="formConductorId"/>
				<span> ¿Está seguro de asignar el conductor al vehículo?</span>
			</div>
		</div>
        
		</form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-success" id="aceptarAsignarConductor">Asignar conductor</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- /#MODAL, VENTANA EMERGENTE PARA ACEPTAR ASIGNAR CONDUCTOR-->


<!-- /#MODAL, VENTANA EMERGENTE PARA ACEPTAR ASINACION FORZADA-->
<div class="modal fade" id="formularioAceptarAsignarForzado" > 
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title">Asignar conductor al vehículo</h3>
      </div>
      <div class="modal-body">
      	<form>
      	<div class="row">
			<div class="col-md-10">
				<input type="hidden" id="formConductorId"/>
				<span> El conductor ya tiene asignado un vehículo. ¿Desea asignarlo a este vehículo?</span>
			</div>
		</div>
        
		</form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-success" id="aceptarAsignarConductorForzado">Si</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- /#MODAL, VENTANA EMERGENTE PARA ACEPTAR ASIGNAR CONDUCTOR-->




<script async defer

     src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDOqPrm-nuqELi0b_kPt7nP0vHFdUunOHc&signed_in=true&libraries=visualization&callback=initMap">
     </script>

</body>


{% endblock %}

